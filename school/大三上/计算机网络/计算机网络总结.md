

<img src="https://i0.hdslb.com/bfs/album/3f2c0ad8dfe05a9ab648e476a1b1b7c8dbeed70b.png" alt="image-20211211103835538" style="zoom:150%;" />









<img src="https://i0.hdslb.com/bfs/album/766b41a3fa9e0d0db82d457d08e4fe00bf9adf65.png" alt="image-20211211103648723" style="zoom:150%;" />









# 计算机网络[^1]

## 概述

1. 计算机网络的特点，互联网发展的三个阶段
2. 互联网的组成（边缘部分，核心部分），交换方式
3. 计算机网络的分类
4. 计算机网络的性能（速率、带宽、吞吐量、时延、时延带宽积、往返时间、利用率、非
性能特征）
5. 计算机网络体系结构，实体、协议、服务之间的关系

### 互联网概述

**三网融合**：电信网络、有线电视网络、计算机网络

互联网的两个重要的基本特点：<u>**连通性**和**共享性**</u>

### 互联网基础结构发展的三个阶段

1. 第一阶段：从单个网络ARPANET(1969)向互联网发展的过程
> 1. 1983 年，TCP/IP 协议成为 ARPANET 上的标准协议，使得所有使用 TCP/IP 协议的计算机都能利用互连网相互通信。
> 2. 把 1983 年作为互联网的诞生时间
2. 第二阶段：1985年起，建成了三级结构的互联网。
> 三级计算机网络，分为**主干网、地区网和校园网**。覆盖了全美的大学和研究所。

<img src="https://i0.hdslb.com/bfs/album/35db3b51df106be97aab8d5c9fc54b1171ca0166.png" alt="image-20211208095246028" style="zoom: 50%;" />


3. 第三阶段：1993年后，逐渐形成了商用的，多层次 ISP 结构的互联网。 
> 1. 出现了互联网服务提供者 ISP (Internet Service Provider)
> 2. 根据提供服务的覆盖面积大小以及所拥有的IP地址数目的不同，ISP 也分成为不同层次的 ISP：<u>主干 ISP、地区 ISP和本地 ISP</u>。

**互联网**(Internet)，特指当前全球最大的、开放的、由众多网络相互连接而成的特定互联网。采用**TCP/IP** 协议族作为通信规则，是一个覆盖全球、实现全球范围内连通性和资源共享的计算机网络。

**internet**（互连网）是一个通用名词，它泛指由多个计算机网络互连而成的网络。

1983年为“互联网（Internet）”的元年，<u>1994年4月20日中国接入互联网。</u>



<center><strong>互联网与互连网</strong></center>

<table>
	<tr>
	    <th>互联网（Internet）</th>
	    <th>互连网（internet）</th>
	</tr >
	<tr >
	    <td colspan="2"><strong>相似之处</strong></td>
	</tr>
	<tr>
	    <td>网络的网络</td>
	    <td>网络的网络</td>
	</tr>
	<tr>
	    <td colspan="2"><strong>不同之处</strong></td>
	</tr>
	<tr>
	    <td><div style="width:180px">特指遵循 TCP/IP 标准、利用路由器将各种计算机网络互连起来而形成的、一个覆盖全球的、特定的互连网</div></td>
	    <td><div style="width:180px">泛指由多个不同类型计算机网络互连而成的网络</div></td>
	</tr>
	<tr>
        <td>使用 TCP/IP</td>
	    <td>除 TCP/IP 外，还可以使用其他协议</td>
	</tr>
	<tr>
	    <td>是一个专用名词</td>
	    <td>是一个通用名词</td>
	</tr>
</table>


### **互联网的组成**

**边缘部分**：由所有连接在互联网上的主机组成。这部分是用户直接使用的，用来进行通信（传送数据、音频或视频）和**资源共享**。

**核心部分**：由大量网络和连接这些网络的路由器组成。这部分是为边缘部分提供服务的（提供**连通性**和交换）。

处在互联网边缘的部分就是连接在互联网上的所有的主机。这些主机又称为`端系统 (end system)`。


端系统之间通信的含义:
`“主机 A 的某个进程和主机 B 上的另一个进程进行通信”`简称为“**计算机之间通信**”。 

端系统之间的两种通信方式:

1. 客户服务器方式（C/S方式）：即 Client/Server 方式，简称为 C/S 方式。 

   > 1. 客户 (client) 和服务器 (server) 都是指通信中所涉及的两个应用进程
   > 2. 客户是服务的请求方，服务器是服务的提供方
   > 3. 客户程序必须知道服务器程序的IP地址或域名，服务器程序不需要知道客户程序的地址
   > 4. 客户与服务器的通信关系建立后，通信可以是双向的，客户和服务器都可发送和接收数据。


2. 对等方式（P2P方式）：即 PeertoPeer 方式 ，简称为 P2P 方式。

   > 1. 对等连接 (peer-to-peer，简写为 P2P ) 是指<u>两个主机在通信时并不区分哪一个是服务请求方还是服务提供方。</u>
   > 2. 只要两个主机都运行了对等连接软件 ( P2P 软件) ，它们就可以<u>进行平等的、对等连接通信</u>。

核心部分:

​    网络中的核心部分要向网络边缘中的大量主机**提供连通性**，使边缘部分中的任何一个主机都能够向其他主机通信（即传送或接收各种形式的数据）。

### **交换技术**

1. 电路交换：必定是面向连接的（`建立连接`，`通信`，`释放连接`）

   N 部电话机两两直接相连，需 $$N(N –1)/2$$ 对电线。电线对的数量与电话机数量的平方（$N^2$）成正比

   **交换机** ： 所采用的交换方式就是**电路交换** (circuit switching)

   > 计算机数据具有突发性，且占用端的全部资源，通信线路的利用率很低。
   >
   
2. **分组交换**：

   分组交换在电路交换基础上，采用<u>**存储转发**</u>技术（在发送端，先把较长的报文划分成较短的、固定长度的数据段；在接收端把收到的数据恢复成为原来的报文）

   > **以分组为基本单位在网络中传送**
   1. 每个分组在互联网中<u>**独立地选择传输路径**</u>。
   2. 用这样的**<u>存储转发</u>**方式，最后分组就能到达最终目的地。


|优点 | 所采用的手段 |
|:--:|:---|
|高效|在分组传输的过程中**动态分配**传输带宽，对通信链路是逐段占用|
|灵活|为每一个分组**独立地**选择最合适的转发路由|
|迅速|以**分组**作为传送单位，可以**不先建立连接**就能向其他主机发送分组|
|可靠|保证可靠性的网络协议；分布式多路由的分组交换网，使网络有很好的生存性|

分组交换带来的问题：
	1. 分组在各结点存储转发时需要**排队**，这就会造成一定的**时延**。 
	2. 分组必须携带的首部（里面有必不可少的控制信息）也造成了一定的**开销**。 
	3. 需要有额外的管理和控制机制。

> 互联网的核心部分采用了<u>分组交换</u>技术。

3. 报文交换

<img src="https://i0.hdslb.com/bfs/album/908b4d62e994628b0dcb257e529c802b5c7687e8.png" alt="image-20211209145714329" style="zoom: 33%;" />



**三种交换的比较**

```python
若要连续传送大量的数据，且其传送时间远大于连接建立时间，则`电路交换`的传输速率较快。
报文交换和分组交换不需要预先分配传输带宽，在传送`突发数据`时可提高整个网络的`信道利用率`。
由于一个分组的长度往往远小于整个报文的长度，因此`分组交换比报文交换的时延小`，同时也具有更好的灵活性。
```

### 不同类别的网络

#### 按照网络的作用范围进行分类

+ 广域网 `WAN`
+ 城域网 `MAN`
+ 局域网 `LAN`
+ 个人区域网 `PAN`

#### 按照网络的使用者进行分类

+ 公用网 (public network) 

  > 按规定交纳费用的人都可以使用的网络。因此也可称为公众网
+ 专用网 (private network) 

  > 为特殊业务工作的需要而建造的网络

#### 用来把用户接入到互联网的网络

+ 接入网 `AN` (Access Network)

  接入网是从某个用户端系统到互联网中的**第一个**路由器（也称为边缘路由器）之间的一种网络。在小区中常见。

> 接入网本身既不属于互联网的核心部分，也不属于互联网的边缘部分



### 计算机网络的性能指标

> 涉及到传输速率 `1Tb/s` $= 10^3$ `Gb/s` $= 10^6$ `Mb/s` $= 10^9$ `Kb/s` $= 10^{12}$ `b/s`的单位转换
| 名词 | 说明 |
|:--:|:--|
|速率 | 1. **数据的传送速率** <br>2. 速率往往是指额定速率或标称速率，非实际运行速率   <br>3. 数据率或比特率，单位是$bit/s$ |
|带宽 |  1. 带宽用来表示网络中**某通道传送数据的能力**<br>2. 表示在单位时间内网络中的某信道所能通过的“最高数据率”<br>3. 单位是 $bit/s$，即 “比特每秒”|
|吞吐率 |1. 吞吐量表示**在单位时间内通过某个网络（或信道、接口）的数据量** <br>2. **吞吐量受网络的带宽或网络的额定速率的限制** <br>3. 对吞吐量的测量，以便于知道实际有多少数据量能够通过网络 |
|时延 | 1. 时延是指数据从网络的一端传送到另一端所需的时间，包含有（发送时延、传播时延、处理时延、排队时延） |
|时延带宽积 | 1. 链路的时延带宽积又称为`以比特为单位的链路长度` |
|往返时间RTT | 1. 往返时间 RTT 表示从发送方发送数据开始，到发送方收到来自接收方的确认，总共经历的时间。（`ping`）|
|利用率 | *信道利用率*和*网络利用率* |

#### 时延

##### 发送时延

+ 发送数据时，数据帧<u>从结点进入到传输媒体所需要的时间</u>（**从发送数据帧的第一个比特算起，到该帧的最后一个比特发送完毕所需的时间**）

$$
发送时延  =  \dfrac{数据帧长度（bit）}{发送速率（bit/s）}
$$

> 发送速率，理想下是设备的信道带宽

##### 传播时延

+ **电磁波在信道中需要传播一定的距离而花费的时间**

$$
传播时延  =  \dfrac{信道长度（米）}{信号在信道上的传播速率（米/秒）}
$$
> 电磁波的速度就是光速：$3*10^8$米/每秒，根据传输介质不同，速度不同；不过一般计算题的传播速度是$2*10^8$米/每秒.

##### 处理时延

+ 主机或路由器在收到分组时，为<u>处理分组（例如分析首部、提取数据、差错检验或查找路由）所花费的时间</u>。 

##### 排队时延

+ 分组在路由器输入输出队列中<u>排队等待处理</u>所经历的时延 
+ **排队时延的长短往往取决于网络中当时的通信量**

#### 时延计算

$$
总时延 = 发送时延 + 传播时延 + 处理时延 + 排队时延
$$

#### 四种时延所产生的地方

<img src="https://i0.hdslb.com/bfs/album/b123846a02f5d1c54ecea22b7a239f363d0ea060.png" alt="image-20211209154445143" style="zoom: 50%;" />

#### 易错点

> `高带宽链路上，比特会传送得更快些（错误）` 

1. 对于高速网络链路，我们提高的仅仅是数据的**发送速率**而不是比特在链路上的**传播速率**。 
2. 提高链路带宽减小了数据的发送时延。 

#### 时延带宽积

$$
时延带宽积 = 传播时延 * 带宽
$$

<img src="https://i0.hdslb.com/bfs/album/4eab188e266a42c3ef499fb06f15dbe1d6957ca6.png" alt="image-20211209155131169" style="zoom: 50%;" />


#### 利用率

- 信道利用率
	> 信道利用率指出某信道有百分之几的时间是被利用的（有数据通过）。
	完全空闲的信道的利用率是零
- 网络利用率
	
	> 网络利用率则是<u>全网络</u>的信道利用率的加权平均值

信道利用率并非越高越好。**当某信道的利用率增大时，该信道引起的时延也就迅速增加**。

<img src="https://i0.hdslb.com/bfs/album/c75cce21e97a82e31e4fe34aee9666ff98e3b2fa.png" alt="image-20211209155507948" style="zoom: 50%;" />


**速率、带宽、吞吐量**区分：

<img src="https://i0.hdslb.com/bfs/album/8796f63a492fbdaaca2c12303d38d7705742c798.png" alt="image-20211209152510518" style="zoom: 50%;" />


### 计算机网络的非性能特征

+ 费用
+ 质量
+ 标准化
+ 可靠性
+ 可扩展性和可升级性 
+ 易于管理和维护 

### 计算机体系结构

ISO组织提出<u>开放系统互连基本参考模型OSI/RM</u>

**具有五层协议的体系结构**：采取折中的办法，即综合OSI和TCP/IP的优点，采用一种只有五层协议的体系结构

<img src="https://i0.hdslb.com/bfs/album/fe4eaeec10a3c11c3e4d45a4b2d211c39748062d.png" alt="image-20211209162046602" style="zoom: 67%;" />



### **实体、协议、服务**

+ **实体** (entity) 表示**<u>任何可发送或接收信息的硬件或软件进程</u>**。 
+ **协议**是控制**两个对等实体**进行通信的规则的集合（水平的）
+ 在协议的控制下，两个对等实体间的通信使得本层能够向上一层提供**服务**。要实现本层协议，还需要使用接口调用下层所提供的服务（垂直的）

-------------------------

## 物理层

1. 物理层基本概念，物理层四大特性
2. 数据通信系统（数据、信号、码元）
3. 信道的分类，信道的极限传输速率（奈氏准则、香农公式）
4. 传输媒体（双绞线、同轴电缆、光纤、短波、微波）
5. 信道复用技术（FDM、TDM、STDM、WDM、CDM）
6. 物理层设备（中继器、集线器）

### 物理层基本概念

​        物理层考虑的是怎样才能在连接各种计算机的传输媒体上传输数据比特流，而不是指具体的传输媒体。
​        物理层的作用是要尽可能地屏蔽掉不同传输媒体和通信手段的差异。

#### 物理层的特性

+ 机械特性：引脚个数和排列、接口的形状和尺寸等
+ 电气特性：电压的范围
+ 功能特性：某一电平的电压意义
+ 过程特性：各功能事件出现的顺序

### 数据通信系统

#### 码元

`码元 (code)`: 码元是指用一个<u>固定时长</u>的信号波形（数字脉冲），代表不同离散数值的基本波形，是数字通信中数字信号的计量单位。有2进制码元，有**k进制码元**。

+ `1码元`可以携带多个比特的信息量。例如，在使用2进制编码时，只有两种不同的码元，一种代表0，另一种代表1。

#### **速率**

   速率，也叫做数据率，是指数据的传输速率。表示<u>单位时间内传输的数据率</u>。可以用**码元传输速率**和信息传输速率表示。

(1)码元传输速率
	**表示单位时间内数字通信系统所传输的码元个数**（又叫做脉冲个数或信号变化的次数），单位是波特（Baud）。1波特表示数字通信系统中每秒传送的码元。这里的码元可以是多进制的，也可以是二进制的，但是**码元速率与进制数无关**。
(2)信息传输速率
	表示单位时间内传输比特的个数。

> 关系：若一个码元携带n bit的信息量，则M波特的码元传输速率多对应的信息传输速率为M*n bit/s

例题：

![image-20211211100427288](https://i0.hdslb.com/bfs/album/0504f37414cc01c5631c2add5d0f5ac6b1a3cc76.png)

![image-20211211100434756](https://i0.hdslb.com/bfs/album/da1873445c5be872adb07745231f4ef5ac3d9c77.png)



#### 信道

信道和电路关系：一条电路通常包含**一条发送信道**和**一条接收信道**

#### 信道的分类

+ 单向通信（单工通信）：只能有一个方向的通信而没有反方向的交互。
+ 双向交替通信（半双工通信）：通信的双方都可以发送信息，但不能双方同时发送(当然也就不能同时接收)。
+ 双向同时通信（全双工通信）：通信的双方可以同时发送和接收信息。 🔰计算机网络🔰

基带信号：来自信源的信号。像计算机输出的代表各种文字或图像文件的数据信号都属于基带信号。
带通信号 ：经过载波调制后的信号。

##### 调制分为两大类：

+ 基带调制：仅对基带信号的波形进行变换，使它能够与信道特性相适应。变换后的信号仍然是基带信号。数字信号转化成数字信号，我们把这种过程称为编码 (coding)。
+ 带通调制：使用载波 (carrier)进行调制，把基带信号的频率范围搬移到较高的频段，并转换为模拟信号，这样就能够更好地在模拟信道中传输（即仅在一段频率范围内能够通过信道）。


##### 基带调制常用编码方式
+ 不归零制
+ 归零制
+ 曼彻斯特编码：位周期中心的向上跳变代表0，位周期中心的向下跳变代表1。
+ 差分曼彻斯特编码：在每一位的中心处始终都有跳变。位开始边界有跳变代表0，而位开始边界没有跳变代表1。

<img src="https://i0.hdslb.com/bfs/album/6e77b84cff2aec5c6f1b57b26ff77c9274a2d7d4.png" alt="image-20211211102116053" style="zoom:50%;" />


> 从自同步能力来看，不归零制<u>不能从信号波形本身中提取信号时钟频率</u>（这叫做没有自同步能力），而<u>归零制、曼彻斯特编码和差分曼彻斯特编码具**有自同步能力**</u>。


#####  带通调制

许多信道并不能传输基带信号这种低频分量或直流分量，必须进行调制。

调制方法
1. `调幅(AM)`：载波的振幅随基带数字信号而变化。 
2. `调频(FM)`：载波的频率随基带数字信号而变化。
3. `调相(PM)`：载波的初始相位随基带数字信号而变化

<img src="https://i0.hdslb.com/bfs/album/1fa69c1c0a18b995a35052678d18c1df8217a3f5.png" alt="image-20211211102515664" style="zoom: 33%;" />



### **信道的极限传输速率（重点）**

+ 任何实际的信道都不是理想的，在传输信号时会产生各种<u>失真</u>以及带来多种干扰。 

+ <u>码元传输的速率越高，或信号传输的距离越远，或传输媒体质量越差，在信道的输出端的波形的失真就越严重。</u>

  > 在任何信道中，码元传输的速率是有上限的，否则就会出现**码间串扰**的问题，使接收端对码元的判决（即识别）成为不可能。

<img src="https://i0.hdslb.com/bfs/album/8d3444f732c73a484f0af1e5fd576baf8794216e.png" alt="image-20211211104217210" style="zoom:50%;" />

影响失真程度的因素：
+ **码元的传输速率**
+ 信号传输距离
+ 噪声干扰
+ 传输介质

从概念上讲，限制码元在信道上的传输速率的因素有以下两个：
+ 信道能够通过的频率范围（**带宽**）
+ **信噪比**

#### 奈氏准则`(import)`

​		在假定的理想条件下，为了避免码间串扰，码元的传输速率的上限值。

在理想条件下，
$$
信道的极限传输速率 = 2W · log_2V （单位为bit/s）
$$
- $W$为信道带宽
- $V$为码元信号的有效值的`个数`，$log_2V$为码元携带的信息量

> 如果信道的频带越宽，也就是能够通过的信号高频分量越多，那么就可以用更高的速率传送码元而不出现码间串扰。



#### 信噪比`(import)`
​	<u>信噪比就是信号的平均功率和噪声的平均功率之比</u>。并用分贝 `(dB) `作为度量单位。即：

$$
1 dB = 10 log_{10}(\dfrac{S}{N})
$$

> 当$\dfrac{S}{N} = 10$时，信噪比为$10dB$. 当$\dfrac{S}{N} = 1000$，信噪比为$30dB$

#### 香农公式`(import)`
​	香农 (Shannon) 用信息论的理论推导出了<u>带宽受限且有高斯白噪声干扰的信道的极限、无差错的信息传输速率（香农公式）</u>。

信道的`极限信息传输速率 C `可表达为
$$
C = W log_2(1+\dfrac{S}{N})   （单位为bit/s）
$$

+ W 为信道的带宽（以 Hz 为单位）
+ S 为信道内所传信号的平均功率
+ N 为信道内部的高斯噪声功率

结论
1. 信道的带宽或信道中的**信噪比越大**，则信息的极限传输速率就越高。 

2. 只要信息传输速率低于信道的极限信息传输速率，就一定可以找到某种办法来实现无差错的传输。 

3. 若信道带宽 $W$ 或信噪比 $\dfrac{S}{N}$ 没有上限（当然实际信道不可能是这样的），则信道的极限信息传输速率 $C$也就没有上限。

   

**奈氏准则和香农公式作用分不清？**


(1) 奈氏准则：**带宽受限无噪声条件下的码元传输速率上限**.
$$
C = 2W · log_2V （单位为bit/s）
$$
想要提高，就要***提高带宽**或采用**更好的编码技术***

(2) 香农公式：**带宽受限有噪声条件下的信息传输速率上限**.
$$
C = W log_2(1+\dfrac{S}{N})  （单位为bit/s）
$$
想要提高，就要*提高**带宽**或**信噪比***

### 传输媒体

**导引型传输媒体** 

+ 双绞线
+ 同轴电缆
+ 光纤

**非导引型传输媒体** 

+ 短波

  > 短波通信主要是靠电离层的反射，通信质量较差，但穿透性强。

+ 微波

  > 微波在空间主要是直线传播。
  > <u>5G用的毫米波是属于微波</u>

### 物理层设备

中继器（RP repeater）：适用于<u>完全相同的两个网络（协议一致）的互连</u>，主要功能是通过对数据信号的重新发送或者转发，来扩大网络传输的距离。 **中继器是对信号进行<u>再生</u>和<u>还原</u>的网络设备**。

<img src="https://i0.hdslb.com/bfs/album/3aa309a6d9904a58369768063ba3eb2584a43536.png" alt="image-20211211111745339" style="zoom:50%;" />

<center> 中继器 </center>

集线器（hub）：对信号进行**再生放大转发**。它发送数据时都是没有针对性的，而是<u>采用**广播方式发送**</u>。也就是说当它要向某节点发送数据时，不是直接把数据发送到目的节点，而是把数据包发送到与集线器相连的所有节点。

<img src="C:\Users\yuban\AppData\Roaming\Typora\typora-user-images\image-20211211111926689.png" alt="image-20211211111926689" style="zoom:50%;" />

<center> 集线器 </center>

### 信道复用技术
复用 ：允许用户使用一个共享信道进行通信，降低成本，提高利用率。
+ 频分复用FDM

+ 时分复用TDM

+ 统计时分复用STDM

+ 波分复用WDM

+ 码分复用CDM

  + 码分多址 CDMA
	> 每一个比特时间划分为 m 个短的间隔，称为码片 (chip)。
```R
每个站被指派一个唯一的 m bit 码片序列。
	如发送比特 1，则发送自己的 m bit 码片序列。
	如发送比特 0，则发送该码片序列的二进制反码。 
```

#### CDMA 的重要特点

1. 每个站分配的码片序列不仅**必须各不相同**，并且还必须**互相正交**。
2. 在实用的系统中是使用伪随机码序列。

<img src="https://i0.hdslb.com/bfs/album/9cae5bd18949d4bd51b7d9876e8c71c744eed85a.png" alt="image-20211211145622375" style="zoom: 33%;" />



<img src="https://i0.hdslb.com/bfs/album/df0062e25275b8902b29e2c2f08ba5f32c7972b9.png" alt="image-20211211145659740" style="zoom:33%;" />

#### 练习

<img src="https://i0.hdslb.com/bfs/album/c23d1037814a3151f23abf2fb6dd72efb315b931.png" alt="image-20211211150307669" style="zoom:33%;" />

----------------------------------



## 数据链路层

1. 数据链路层的基本概念（作用、数据链路、帧）
2. 三个基本问题（封装成帧、透明传输、差错检测）
3. 点对点协议 PPP（协议特点、不需要的功能、组成、帧格式、建立过程）
4. 局域网的数据链路层（局域网的特点、局域网的拓扑、以太网、共享信道、CSMA/CD 协
议、集线器的星形拓扑、以太网的信道利用率、以太网的 MAC 层）
5. 在物理层扩展以太网、在数据链路层扩展以太网、虚拟局域网
6. 数据链路层设备（网桥、交换机）



### 数据链路层的基本概念

#### 数据链路层的作用

​		<u>**数据链路层**在物理层提供服务的基础上**向网络层提供服务**，其最基本的服务是将源自网络层来的数据可靠地传输到相邻结点的网络层。</u>

​		<u>其主要作用是**加强物理层传输原始比特流的功能**，将物理层提供的可能出错的物理连接**改造成为逻辑上无差错的数据链路**，使之对网络层表现为一条无差错的链路。</u>

#### 数据链路层使用的信道

1. 点对点信道
   1. 这种信道使用一对一的点对点通信方式。

   <img src="https://i0.hdslb.com/bfs/album/140b3bb34a48c096bc73fd6ee89c3b5fb3e3f78d.png" alt="image-20211211151246787" style="zoom:50%;" />
   
2. 广播信道

   1. 使用一对多的广播通信方式
   2. 必须使用专用的共享信道协议来**协调**这些主机的数据发送
   
   <img src="https://i0.hdslb.com/bfs/album/e85abf6a9a36a77075d8afdb53c94bf5052246df.png" alt="image-20211211151340287" style="zoom:50%;" />

#### 使用点对点信道的数据链路层

+ 结点 (node) 是**指网络中的主机、路由器**等。
+ 链路 (link) 是**一条点到点的物理线路段，中间没有任何其他的交换结点**。一条链路只是一条通路的一个组成部分。
+ 数据链路 (data link) 除了**物理线路**外，还必须有**通信协议**来控制这些数据的传输。若把实现这些协议的硬件和软件加到链路上，就构成了数据链路。`（物理链路+通信协议）`

> 1. **数据链路层传送的是帧**。 
> 2. 帧(frame)：数据链路层的协议数据单元，封装网络层的数据报

<img src="https://i0.hdslb.com/bfs/album/c37e81582bbad6ada12e464f858060d7b28dca77.png" alt="image-20211211152141794" style="zoom:50%;" />

### **三个基本问题** 

+ 封装成帧
+ 透明传输
+ 差错检测

#### 封装成帧

`封装成帧` 就是在一段数据的前后分别添加首部和尾部，然后就构成了一个帧。<u>首部和尾部包含了许多的控制信息</u>。首部和尾部中有帧定界符，其作用是进行帧定界（接收端识别开始和结束）



<img src="https://i0.hdslb.com/bfs/album/d1b5eb1b4864130cde9a78a996d474e4cfeeebab.png" alt="image-20211211152713566" style="zoom:50%;" />

> **帧同步**：接收方应当能从接收到的二进制比特流中区分出帧的起始和终止。

#### 透明传输

​		透明传输是指不管所传数据是什么样的比特组合，都能够在链路上传送。<u>因此，链路层应该“看不见”有什么妨碍数据传输的东西。</u>
例如：如果数据中的某字节的二进制代码恰好和 SOH 或 EOT 一样，链路层就会错误地“找到帧的边界”。

<img src="https://i0.hdslb.com/bfs/album/cea1552453118335a01cf48ac1b3d5b7d1aebc6e.png" alt="image-20211211153015104" style="zoom:50%;" />

<center><strong>错误找到边界</strong></center>


##### 解决透明传输的问题
+ 字符计数法 （在帧首部使用计数字段来表明帧内字符数）

<img src="https://i0.hdslb.com/bfs/album/d2455b29629531e13001ae56ac60aa55e0d1125b.png" alt="image-20211211153238715" style="zoom:50%;" />

+ 字符填充 
   发送端的数据链路层在数据中出现控制字符`SOH`或`EOT`的前面插入一个转义字符`ESC`

<img src="https://i0.hdslb.com/bfs/album/12a6f7ed945fd6cb9c5f4a798fddbfb889876961.png" alt="image-20211211153435722" style="zoom:50%;" />

#### 差错检测

##### **差错类型包括**

1. 位错

   - 奇偶校验
   - **循环冗余码**`（CRC）`

2. 帧错（通过编号解决）
   - 丢失   收到[#1]-[#3]
   - 重复   收到[#1]-[#2]-[#2]-[#3]
   - 乱序   收到[#1]-[#3]-[#2] 

#### 循环冗余码



例题：要发送的数据是`1010 01`，采用CRC校验，生成多项式是1101，那么最终发送的数据是？

步骤：

①根据生成多项式`1101=x^3 + x^2 + x^0`， 得到$$max(x^n) = 3$$

②给发送数据填充3个`0`，发送数据变为`1010 01 000`

③使用变化之后的发送数据`1010 01 000`除生成多项式`1101`，得到余数`001`，作为`FCS`

> 但这种检测方法仍然并不能确定究竟是哪一个或哪几个比特出现了差错。  

##### 为什么数据链路层没有做到`可靠传输`?

+ 仅用循环冗余检验 CRC 差错检测技术只能做到无差错接受 (accept)。
+ 💥💥💥**“无差错接受”是指：<u>“凡是接受的帧（即不包括丢弃的帧），我们都能以非常接近于 1 的概率认为这些帧在传输过程中没有产生差错”。</u>也就是说：“凡是接收端数据链路层接受的帧都没有传输差错”（有差错的帧就丢弃而不接受）。**
+ 单纯使用 CRC 差错检测技术不能实现“无差错传输”或“可靠传输”；在数据链路层使用 CRC 检验，能够实现无比特差错的传输，但这还不是可靠传输。
+ 要做到“无差错传输”（即发送什么就收到什么）就必须再加上**确认**和**重传**机制。 

### PPP（**点对点协议** ）协议

+ PPP协议只支持全双工信道通信

#### PPP协议应当满足的需求

+ 简单性：IETF把**“简单”**作为首要要求

+ **封装成帧** 
+ **透明传输**
+ **差错检测**
+ **多种网络层协议** ： 在同一条物理链路上同时支持多种网络层协议，<u>即封装的IP数据报可以采用多种协议（IP、OSI）</u>。
+ **多种类型链路** 
+ **检测连接状态** 
+ **最大传送单元** ：`最大传送单元MTU`. `MTU`是数据链路层的帧可以载荷的数据部分的最大长度，而不是帧的总长度。
+ **网络层地址协商** 
+ **数据压缩协商** 

#### PPP协议不需要的功能

+ 不需要**纠错**（只需要检查） 
+ 不需要**流量控制**
+ 不需要**序号** 
+ 不需要**多点线路** （只需要点对点的功能）
+ 不需要考虑**半双工或单工链路** 

#### PPP协议的组成

1. 一个<u>将` IP` 数据报封装到串行链路</u>（同步串行/异步串行）的方法
2. 链路控制协议 `LCP (Link Control Protocol)` —— `身份验证`，建立并维护数据链路连接。
3. 网络控制协议 `NCP (Network Control Protocol)` —— PPP可以兼容多种网络层协议。每个不同的网络层协议都要有相应NCP来配置，**为网络层协议建立和配置逻辑连接**。

#### PPP协议的状态图

<img src="https://i0.hdslb.com/bfs/album/ced019f9eb64f37479ab0140a8d69c62f3749c4b.png" alt="image-20211211164516806" style="zoom:50%;" />

#### **PPP** **协议的帧格式**


+ PPP 帧的首部和尾部分别为 `4 个字段`和` 2 个字段`。
+ **标志字段 F** `F = 0x7E`
+ **地址字段 A** 只置为` A = 0xFF`。地址字段实际上并不起作用。
+ **控制字段 C** 通常置为 `C = 0x03`。

**PPP 是面向字节的，所有的 PPP 帧的长度都是整数字节。**

<img src="https://i0.hdslb.com/bfs/album/52de359e702026b368aa0a41c4c4dc9b853c2aba.png" alt="image-20211211165204975" style="zoom:50%;" />



#### 透明传输问题


+ 当 PPP 用在<u>异步传输</u>时，就使用一种特殊的**字符填充法**。

<img src="https://i0.hdslb.com/bfs/album/d6806f084a4e9dfca189c6782f9364ed23c1bb0b.png" alt="image-20211211165436651" style="zoom:50%;" />

+ 当 PPP 用在<u>同步传输</u>链路时，协议规定采用硬件来完成**比特填充**。 这时 PPP 协议采用**零比特填充方法**来实现透明传输。
  + 发送端在 5 个连 1 之后，填入比特 0 再发送出去
  + 接收端把 5 个连 1 之后的比特 0 删除

### 局域网的数据链路层

#### 局域网的特点

1. 网络为一个单位所拥有
2. 地理范围和站点数目均有限

#### **局域网具有如下主要优点**

+ 使用广播信道，各站点关系平等。**局域网上的主机可共享连接在局域网上的各种硬件和软件资源**。
+ 便于系统的扩展和逐渐地演变，各设备的位置可灵活调整和改变。
+ 通信延时短，误码率低，可靠性较高。
+ 数据传输速率范围在`10Mb/s~10Gb/s`。

#### 局域网拓扑

1. 星形网
2. 总线网
3. 环形网

<img src="https://i0.hdslb.com/bfs/album/b16b1e7c4a78e65239a81d2c7feff2c9b4c6b452.png" alt="image-20211211172326299" style="zoom:50%;" />

### 数据链路层的两个子层

#### `LLC`子层
`LCC`层负责识别网络协议，然后对它们进封装。`LCC`报头告诉数据链路层一旦帧被收到了，应该对数据报做处理。

> 屏蔽不同传输媒体的区别

#### `MAC`子层
<u>**MAC层负责帧的封装/卸装，帧的寻址和识别，帧的接收和发送，链路的管理、帧的差错控制等。**</u>

<img src="https://i0.hdslb.com/bfs/album/63e0197da6db237ebcaba2a57ca6c49d3ef66b78.png" alt="image-20211211172952548" style="zoom:50%;" />

### **以太网采取了两种重要的措施**

(1) 采用较为灵活的**无连接**的工作方式

+ <u>不必先建立连接就可以直接发送数据</u>。
+ 对发送的数据帧<u>不进行编号</u>，也<u>不要求对方发回确认</u>。
+ 这样做的理由是局域网信道的质量很好，因<u>信道质量产生差错的概率是很小</u>的。
+ 以太网**只实现无差错接收，不实现可靠传输**

(2) 以太网发送的数据都使用**曼彻斯特 (Manchester) 编码**（高频、自同步）

> 曼彻斯特编码缺点是：它所占的频带宽度比原始的基带信号增加了一倍。



### **共享信道**

+ 使用一对多的**广播通信**方式

<img src="https://i0.hdslb.com/bfs/album/80187156af6d76d349439aabefad77931e530792.png" alt="image-20211211173654624" style="zoom:50%;" />

带来的问题：若多个设备在共享的广播信道上同时发送数据，则会造成彼此干扰，导致发送失败。



### CSMA/CD 协议（载波监听多点接入、碰撞检测）

**Carrier Sense Multiple Access with Collision Detection**

**原理**：每一个正在发送数据的站，**一旦发现总线上出现了碰撞，就要<u>立即停止发送</u>**，免得继续浪费网络资源，然后**等待一段<u>随机时间</u>后再次发送**。

<img src="https://i0.hdslb.com/bfs/album/bce795802725778ba2ee0d5694d7ff7e0dffa803.png" alt="image-20211211174447116" style="zoom:50%;" />



### 争用期

最先发送数据帧的站，在发送数据帧后至多经过时间 2$\tau$  （**两倍的端到端往返时延**，争用期）就可知道发送的数据帧是否遭受了碰撞。

> 经过争用期这段时间还没有检测到碰撞，才能肯定这次发送不会发生碰撞。

**二进制指数类型退避算法** 

<img src="https://i0.hdslb.com/bfs/album/9a595fb23a6f1996449c9f6f80c4a8b1c2d73cee.png" alt="image-20211217092950023" style="zoom:50%;" />

> 以太网规定了最短有效帧长为 64 字节，凡长度小于 64 字节的帧都是由于冲突而异常中止的**无效帧**。



### 改进后的CSMA/CD协议

<img src="https://i0.hdslb.com/bfs/album/dde8c5793afe19a8ba06e22be1dff5782aa1d04a.png" alt="image-20211217100640746" style="zoom:50%;" />

1. 引入发送人为干扰信号（强化碰撞）

2. 等待随机时间截断尖端二进制指数算法



### **CSMA/CD** 协议的重要特性

1. 采用CSMA/CD协议的以太网**不能进行全双工通信**而**<u>只能进行双向交替通信（半双工通信）</u>**

2. **发送的不确定性**使整个以太网的<u>平均通信量远小于以太网的最高数据率</u>。 



### 集线器的星形拓扑

#### 发展历程

+ 粗同轴电缆（总线型拓扑结构）
+ 细同轴电缆（总线型拓扑结构）
+ 双绞线（星形型拓扑结构）

#### 集线器

​	采用**双绞线**的以太网采用**星形拓扑**，在星形的中心则增加了一种可靠性非常高的设备，叫做**集线器 (hub)**。

#### 标准

​	1990 年，IEEE 制定出采用双绞线的星形以太网 `10BASE-T` 的标准 802.3i。

**星形以太网** **10BASE-T**

```python
10：速率为10Mbit/s
BASE: 基带信号
T：双绞线（F代表光纤）
```

#### 集线器的特点

1. 使用集线器的以太网在**<u>逻辑上仍是一个总线网</u>**，各工作站使用的还是 CSMA/CD 协议，并**<u>共享逻辑上的总线</u>**。 

2. 集线器工作在**物理层**，只进行简单的**转发比特**，<u>不进行碰撞检测</u>

### 以太网的信道利用率

#### 以太网占用情况

​		一个站在发送帧时出现了碰撞。经过一个争用期 $2\tau$ 后，可能又出现了碰撞。这样经过若干个争用期后，一个站发送成功了。假定发送帧需要的时间是 $T_0$ 。

<img src="https://i0.hdslb.com/bfs/album/a41c4458716ce4c3a2245562f7391ccb10cbb039.png" alt="image-20211217104151511" style="zoom:50%;" />

##### 参数$\alpha$与利用率

+ 要提高以太网的信道利用率
+ 以太网定义了参数$\alpha$，它是以太网单程端到端时延$\tau$ 与帧的发送时间 $T_0$ 之比： 

$$
\alpha = \dfrac{\tau}{T_0}
$$

> $\alpha$越大，表明争用期所占的比例增大，每发生一次碰撞就浪费许多信道资源，使得信道利用率明显降低.

##### 对参数$\alpha$的要求

为提高利用率，以太网的参数$\alpha$的值应当尽可能小些。

对以太网参数$\alpha$的要求是：
1. 当数据率一定时，**以太网的连线的长度要受到限制**，否则$\tau$的数值会太大。
2. **以太网的帧长不能太短**，否则$T_0$的值会太小，使$\alpha$值太大。

##### 信道最大最大利用率

$$
信道最大利用率 = \dfrac{T_0}{T_0 + \tau} = \dfrac{1}{1+\alpha}
$$



### 以太网的MAC层

#### **以太网适配器**

适配器的重要功能：
+ 在计算机的操作系统安装设备驱动程序。
+ 进行串行/并行转换。
+ 对数据进行缓存。
+ 实现以太网协议。

#### MAC

+ `MAC`包含有`48`位
+ 在局域网中，硬件地址又称为物理地址，或 MAC 地址（全球唯一）

<img src="https://i0.hdslb.com/bfs/album/eee2fc598193f18775e1cf2d7c60223f19c02333.png" alt="image-20211217111240080" style="zoom:50%;" />



#### 以太网 V2 的MAC帧格式

> 最常用的 MAC 帧是<u>以太网 V2 的格式</u>。

<img src="https://i0.hdslb.com/bfs/album/7f5d9cd72f27688b34272cc8c46cbf70a48ed516.png" alt="image-20211217111616137" style="zoom:50%;" />

`类型字段`用来标志上一层使用的是什么协议，以便把收到的 MAC 帧的数据上交给上一层的这个协议。

`数据字段`的正式名称是 MAC 客户数据字段。

> 1. $$最小长度 64 字节 - 18 字节的首部和尾部 = 数据字段的最小长度（46字节）$$
> 2. 数据字段的长度为46字节~1500字节

`FCS`字段，4字节，填充字段，**以保证以太网的** **MAC** **帧长不小于** **64** **字节。** 



#### 无效的MAC帧

+ 帧的长度不是整数个字节；
+ 用收到的帧检验序列 FCS 查出有差错；
+ 数据字段的长度不在 46 ~ 1500 字节之间。
+ 有效的 MAC 帧长度为 64 ~ 1518 字节之间。

> 对于检查出的无效 MAC 帧就简单地丢弃。**<u>以太网不负责重传丢弃的帧</u>**。 



### 拓展的以太网

#### 使用物理层拓展以太网

1. 使用**光纤**扩展
2. 使用**集线器**扩展：**将多个以太网段连成更大的、多级星形结构的以太网**💖
   1. 优点
      1. 使原来属于不同碰撞域的以太网上的计算机能够进行跨碰撞域的通信。
      2. 扩大了以太网覆盖的地理范围
   2. 缺点
      1. 碰撞域增大，但总的吞吐量没有提高
      2. 如果不同的碰撞域**<u>使用不同的数据率</u>**，那么就不能用集线器将它们互连起来

<img src="https://i0.hdslb.com/bfs/album/4966a95353ca18d0c6a4d98776ed18c32ad5768f.png" alt="image-20211217112632855" style="zoom:50%;" />



##### 碰撞域

`碰撞域`（collision domain）又称为冲突域，<u>是指网络中一个站点发出的帧会与其他站点发出的帧产生碰撞或冲突的那部分网络</u>。

<img src="https://i0.hdslb.com/bfs/album/e92026e2423b3cd8779e2eb6d0f57612b03b5170.png" alt="image-20211217113117581" style="zoom: 50%;" />

##### 广播域

`广播域`（broadcast domain）：<u>指这样一部分网络，其中任何一台设备发出的广播通信都能被该部分网络中的所有其他设备所接收</u>。

<img src="https://i0.hdslb.com/bfs/album/3eee50cbe00576f2398899a88691ffc83c727684.png" alt="image-20211217135454506" style="zoom:50%;" />

#### 在数据链路层拓展以太网

##### 网桥

1. 网桥工作在**数据链路层**
2. <u>根据MAC帧的目的地址对收到的帧进行转发和过滤</u>。
3. 当网桥收到一个帧时，并不是向所有的接口转发此帧，而是**<u>先检查此帧的目的 MAC 地址，然后再确定将该帧转发到哪一个接口，或把它丢弃。</u>** 

##### 交换机

1. 以太网交换机实质上就是一个**多接口的网桥**
2. 以太网交换机具有并行性（能够同时连接多对接口，使多对主机能够同时通信）

###### 交换机特点

1. 相互通信的主机都是独占传输媒体，**无碰撞**地传输数据。

<img src="https://i0.hdslb.com/bfs/album/61c1d9c2129fe09fb03d68213803af42f998da51.png" alt="image-20211217114009505" style="zoom:50%;" />

2. 以太网交换机的**接口有存储器**，能在输出端口繁忙时把到来的帧进行缓存。
3. 以太网交换机是一种**即插即用设备**，其内部的**帧交换表**（又称为地址表）是通过<u>自学习算法</u>自动地逐渐建立起来的。
4. 价格不贵

#### 交换机的交换方式

+ 存储转发
  + 把整个数据帧**先缓存**后再进行处理
+ 直通方式
  + 接收数据帧的同时就**<u>立即按数据帧的目的 MAC 地址决定该帧的转发接口</u>**，因而提高了帧的转发速度。（不进行差错校验，可能转发中存在无效帧）

#### 交换机自学习功能

以太网交换机运行自学习算法自动维护交换表

<img src="https://i0.hdslb.com/bfs/album/e953b61c9798e523ae1c46c844dd8a9b22fcb1d7.png" alt="image-20211217134514340" style="zoom:50%;" />

##### 自学习功能例题

<img src="https://i0.hdslb.com/bfs/album/fce24ab393aa89e8472f9eae2e3e3053f65f6e59.png" alt="image-20211217134548170" style="zoom:50%;" />

答案：最终的交换机交换表如下：

<img src="https://i0.hdslb.com/bfs/album/3edbb106c3015f956ca8d2fc253451bf448d033f.png" alt="image-20211217134627401" style="zoom:50%;" />

> 存在回路问题
>
> 解决方案：STP生成树协议：不改变网络的实际拓扑，但**在逻辑上则切断某些链路**，使得从一台主机到所有其他主机的路径是**无环路的树状结构**，从而消除了兜圈子现象。

### 从总线以太网到星形以太网

+ 之前，以太网采用**无源的总线结构**。现在，采用**以太网交换机的星形结构**成为以太网的首选拓扑。
+ 总线以太网使用 CSMA/CD 协议，以半双工方式工作。**以太网交换机不使用共享总线，没有碰撞问题，因此不使用 CSMA/CD 协议，以<u>全双工方式工作</u>**。但仍然采用以太网的帧结构。

<img src="https://i0.hdslb.com/bfs/album/241e7ab0f78702f54ef1eda2157f81a89b6135cd.png" alt="image-20211217135212419" style="zoom:50%;" />



### 虚拟局域网

> 虚拟局域网其实只是局域网给用户提供的一种**<u>服务</u>**，而并不是一种新型局域网。

<img src="https://i0.hdslb.com/bfs/album/42f32a5cad5d8fd8bfbb898048d64e452e0ab57c.png" alt="image-20211217135900052" style="zoom: 50%;" />

优点：**<u>虚拟局域网限制了接收广播信息的工作站数，使得网络不会因传播过多的广播信息</u>** (即“广播风暴”) 而引起性能恶化。 

#### VLAN的优点

虚拟局域网（VLAN）技术具有以下主要优点：
+ 改善了性能——**避免的广播风暴**，节省了带宽
+ 简化了管理——只需要网管改改配置
+ 降低了成本——不需要购买更多的设备
+ 改善了安全性——隔离的数据

### 划分虚拟局域网的方法

1. 基于交换机<u>端口</u>
2. 基于计算机网卡的<u>MAC地址</u>
3. 基于<u>协议</u>类型
4. 基于<u>IP子网</u>地址
5. 基于<u>高层应用或服务</u>

### 虚拟局域网使用的以太网帧格式

​	虚拟局域网协议允许在以太网的帧格式中插入一个`4字节`的标识符，称为 <u>VLAN 标记</u> (tag)，用来指明该帧属于哪一个虚拟局域网。

+ 插入VLAN标记得出的帧称为 **<u>802.1Q帧</u>**或带标记的以太网帧

<img src="https://i0.hdslb.com/bfs/album/419a2c51083407bd15ee62d17f25b37205017e46.png" alt="image-20211217141230072" style="zoom:50%;" />



## 网络层

1. 虚电路服务和数据报服务的对比
2. 分类的 IP 地址
3. IP 地址与硬件地址，地址解析协议 ARP
4. IP 数据报的格式
5. IP 层转发分组的流程
6. 划分子网（子网掩码、划分子网、使用子网时分组的转发）
7. 无分类域间路由 CIDR
8. 网际控制报文协议（ICMP）
9. 路由选择协议（静态和动态路由选择、内部网关协议、外部网关协议、路由器的构成）
10. IPv6（IPv6 和 IPv4 的对比）
11. 虚拟专用网 VPN 和网络地址转换 NAT



### 虚电路服务和数据报服务

**虚电路服务和数据报服务对比**

<img src="https://i0.hdslb.com/bfs/album/56db4569b896d7e334a541786713b8dcee0d76ed.png" alt="image-20211217144846571" style="zoom: 50%;" />

### 网际协议IP
与 IP 协议配套使用的还有三个协议：
+ 地址解析协议 `ARP` (Address Resolution Protocol)
+ 网际控制报文协议 `ICMP` (Internet Control Message Protocol)
+ 网际组管理协议 `IGMP` (Internet Group Management Protocol)

<img src="https://i0.hdslb.com/bfs/album/066837833849dfb20f7a0715b5a632080bf575c7.png" alt="image-20211217150140386" style="zoom: 50%;" />

### 分类的 IP 地址

> IP 地址就是给每个连接在互联网上的主机（或路由器）分配一个在全世界范围是**<u>唯一的 32 位的标识符</u>**。



#### IP地址的编址方法(`点分十进制法`)

1. 分类的IP地址

   <img src="https://i0.hdslb.com/bfs/album/c88215bb4da1cf6387994742b867e0c3996199fe.png" alt="image-20211217152747492" style="zoom:50%;" />

   1. A类地址`0-127`
   2. B类地址`128-191`
   3. C类地址`192-223`

<img src="https://i0.hdslb.com/bfs/album/365238638b2c95f9e42b990b3f2e6b6b48d961d8.png" alt="image-20211217152845767" style="zoom:50%;" />

1. 子网划分
2. 构成超网
   1. 无分类编址方法

#### IP地址的特点

（1）IP地址是一种**分等级的地址结构**

（2）实际上 IP 地址是**标志一个主机（或路由器）和一条链路的接口**

（3）**用转发器或网桥连接起来的若干个局域网仍为一个网络，因此这些局域网都具有同样的网络号 net-id。**

（4）所有分配到网络号 net-id 的网络，无论是范围很小的局域网，还是可能覆盖很大地理范围的广域网，都是<u>平等</u>的。

### IP地址与硬件地址

1. 硬件地址（或物理地址）是数据链路层和物理层使用的地址。（`MAC地址`）
2. `IP地址`是网络层和以上各层使用的地址，是一种逻辑地址（称IP地址是逻辑地址是因为IP地址是用软件实现的）。

<img src="https://i0.hdslb.com/bfs/album/a78f8459facacbb89ca8c5f484221bbac5919f79.png" alt="image-20211217154515568" style="zoom:33%;" />

#### 数据流动

<img src="https://i0.hdslb.com/bfs/album/e156a14130cbe38fe3f804b825208afad2490ab8.png" alt="image-20211217154643345" style="zoom: 25%;" />

<img src="https://i0.hdslb.com/bfs/album/7c707077f5c622f84999e5bf9248a181794a834e.png" alt="image-20211217154811919" style="zoom: 25%;" />

<img src="https://i0.hdslb.com/bfs/album/3be8127eee514980c79f1143c2bcdb119e74a3dd.png" alt="image-20211217154825026" style="zoom: 25%;" />

+ 路由器**只根据目的站的 IP 地址的网络号进行路由选择**。 


#### 主机 H1 与 H2 通信中使用的IP地址 与 硬件地址 HA

<img src="https://i0.hdslb.com/bfs/album/87c4171de7d0c0f64fa052bcf187ee0b06d62031.png" alt="image-20211217155137575" style="zoom:50%;" />

### 地址解析协议ARP

**ARP 作用**：<u>从网络层使用的 IP 地址，解析出在数据链路层使用的硬件地址。</u>

> 不管网络层使用的是什么协议，在实际网络的链路上传送数据帧时，最终还是**<u>必须使用硬件地址</u>**。

每一个主机或路由器都设有一个 **ARP 高速缓存** (ARP cache)，里面有所在的局域网上的各主机和路由器的 IP 地址到硬件地址的映射表。

<img src="https://i0.hdslb.com/bfs/album/6ee45d9394e2b188471ffca3500f298b55e413dc.png" alt="image-20211217160213704" style="zoom:50%;" />



#### 地址解析协议ARP 要点

1. 当主机 A 欲向本局域网上的某个主机 B 发送 IP 数据报时，就**<u>先在其 ARP 高速缓存中查看有无主机 B 的 IP 地址</u>**。

	（a）如**有**，就可查出其对应的硬件地址，再**将此硬件地址写入 MAC 帧**，然后通过局域网将该 MAC 帧发往此硬件地址。

	（b）如**没有**， **<u>ARP 进程在本局域网上广播发送一个 ARP 请求分组</u>**。收到 ARP 响应分组后，将**得到的 IP 地址到硬件地址的映射写入ARP 高速缓存**。

2.  ARP请求和相应分组
   
   > 路由器<u>不转发ARP请求</u>
   
   包含有如下信息
   
   1. 发送方硬件地址
   2. 发送方 IP 地址
   3. 目标方硬件地址(未知时填 0)
   4. 目标方 IP 地址
   
3. **<u>ARP 分组封装在物理网络的帧中传输</u>**

#### ARP 高速缓存的作用
​	存放最近获得的 IP 地址到 MAC 地址的绑定，以**<u>减少 ARP 广播的数量</u>**。

#### ARP需要注意的问题
ARP 用于解决**<u>同一个局域网上</u>**的主机或路由器的 IP 地址和硬件地址的映射问题。

> 如果所要找的主机和源主机<u>不在同一个局域网上</u>，那么就要通过 ARP 找到一个位于本局域网上的某个路由器的硬件地址，然后把分组发送给这个路由器，让这个路由器把分组转发给下一个网络。剩下的工作就由下一个网络来做。



### IP 数据报的格式
+ 一个 IP 数据报由**首部**和**数据**两部分组成。
+ 首部的前一部分是固定长度，共 `20 字节`，是所有 IP 数据报必须具有的。
+ 在首部的固定部分的后面是一些**可选字段，其长度是可变的**。 

<img src="https://i0.hdslb.com/bfs/album/32adb298b2942accdd3ea7671d351a0072ccff5c.png" alt="image-20211217162432900" style="zoom:50%;" />

**版本**: 占 4 位，指 IP 协议的版本。目前的 IP 协议版本号为 4 (即 IPv4)

**首部长度**: 占 4 位，可表示的最大数值是 15 个单位(一个单位为 4 字节)，因此 **IP 的首部长度的最大值是 60 字节，最小值是20字节**

**区分服务**：占 8 位，用来获得更好的服务。在旧标准中叫做服务类型，但实际上一直未被使用过。1998 年这个字段改名为**区分服务（往往用于优先级）**。只有在使用区分服务（DiffServ）时，这个字段才起作用。在一般的情况下都不使用这个字段。 

**总长度**：占 16 位，指**<u>首部和数据之和的长度</u>**，单位为字节，因此数据报的最大长度为 65535 字节。<u>总长度必须不超过最大传送单元MTU</u>。

**标识**：占 16 位，它是一个计数器，**用来产生 IP 数据报的标识**

**标志**(flag)：占 3 位，目前只有**前两位**有意义。
+ **<u>标志字段的最低位是 MF</u>** (More Fragment)。
  - MF=1 表示后面“还有分片”
  - MF=0 表示最后一个分片
+ **<u>标志字段中间的一位是 DF</u>** (Don't Fragment) 
    - 只有当 DF=0 时才允许分片。

**片偏移**：占13 位，指出：较长的分组在分片后，**某片在原分组中的相对位置**。片偏移以 8 个字节为偏移单位。

**生存时间**：占8 位，记为 `TTL` (Time To Live)，**<u>指示数据报在网络中可通过的路由器数的最大值</u>**。每经过一个路由器减1。到0后，丢弃该数据报。

**协议**：占8位，**指出此数据报携带的数据使用何种协议**，以便目的主机的 IP 层将数据部分上交给哪个处理过程。

> TCP是6，UDP是17

<img src="https://i0.hdslb.com/bfs/album/0b140d074c7a12d5a51b68ef07925e36269b18cb.png" alt="image-20211217170830808" style="zoom:50%;" />

**首部检验和**：占16 位，**只检验数据报的<u>首部</u>**，<u>不检验数据部分</u>。这里不采用 CRC 检验码而采用简单的计算方法（采用 16 位二进制反码求和算法）。 

IP 首部的**可变部分**就是一个选项字段，用来**<u>支持排错、测量以及安全</u>**等措施，内容很丰富。选项字段的长度可变，从 <u>0 个字节到 40 个字节</u>不等，取决于所选择的项目。

#### IP数据包分片例题

<img src="https://i0.hdslb.com/bfs/album/532307fb73cdf3da9751f0a18b8a8cb90a4c2994.png" alt="image-20211217170224679" style="zoom:50%;" />

<img src="https://i0.hdslb.com/bfs/album/4fbea2272c2559c0542bd592f280e826594e70d0.png" alt="image-20211217170238811" style="zoom:50%;" />



### 查找路由表

**<u>根据目的网络地址</u>**就能确定下一跳路由器，这样做的结果是：

+ IP 数据报最终一定可以找到目的主机所在目的网络上的路由器（可能要通过多次的**间接交付**）。
+ 只有到达最后一个路由器时，才试图向目的主机进行**直接交付**。 

### 默认路由

​	路由器还可采用<u>默认路由</u>以**减少路由表所占用的空间和搜索路由表所用的时间**。

### 路由器分组转发算法
1. 从数据报的首部提取目的主机的 IP 地址 D, 得出目的网络地址为 N。
2. <u>若网络 N 与此路由器直接相连，则把数据报直接交付目的主机 D</u>；否则是间接交付，执行 (3)。
3. 若路由表中有目的地址为 D 的**特定主机路由**，则把数据报传送给路由表中所指明的下一跳路由器；否则，执行 (4)。
4. 若路由表中有到达**网络 N** 的路由，<u>则把数据报传送给路由表指明的下一跳路由器</u>；否则，执行 (5)。
5. 若路由表中有一个**默认路由**，则<u>把数据报传送给路由表中所指明的默认路由器</u>；否则，执行 (6)。
6. 报告转发分组出错。 

### 划分子网

1. 当没有划分子网时，IP 地址是两级结构。划分子网后 IP 地址就变成了**三级结构**。
2. 划分子网只是把 IP 地址的主机号 host-id 这部分进行再划分，而不改变 IP 地址原来的网络号 net-id。 

<img src="https://i0.hdslb.com/bfs/album/88b5fbb40413f51f8da935e3c0fd7f89fcfceb66.png" alt="image-20211217193336852" style="zoom:50%;" />

#### 优点

+ 使网络的组织更加灵活
+ 更便于维护和管理

+ 划分子网纯属一个单位内部的事情，对外部网络透明，**对外仍然表现为没有划分子网的一个网络**。

### 子网掩码



### **子网划分**

+ 固定长度子网
+ 变长子网

> ​	在采用**<u>固定长度子网</u>**时，所划分的所有子网的子网掩码都是相同的

<img src="https://i0.hdslb.com/bfs/album/79e2c8b0be825c8f46d78f707966a76ea51b89b6.png" alt="image-20211217194744448" style="zoom:50%;" />

<img src="https://i0.hdslb.com/bfs/album/0399fc80e6c4de2a4070a9e17886855b66fe7641.png" alt="image-20211217194909750" style="zoom:50%;" />

> 不同的子网掩码下，NET-ID可能相同。



### 使用子网时分组的转发

**在划分子网情况下路由器转发分组的算法**
1. 从收到的分组的首部提取目的 IP 地址 D。
2. 先用<u>**各网络的子网掩码和 D 逐位相“与”**，看是否和相应的网络地址匹配</u>。若匹配，则将分组直接交付。否则就是间接交付，执行(3)。
3. 若路由表中有目的地址为 D 的特定主机路由，则将分组传送给指明的下一跳路由器；否则，执行 (4)。
4. 对路由表中的每一行，将子网掩码和 D 逐位相“与”。若结果与该行的目的网络地址匹配，则将分组传送给该行指明的下一跳路由器；否则，执行 (5)。
5. 若路由表中有一个默认路由，则将分组传送给路由表中所指明的默认路由器；否则，执行 (6)。
6. 报告转发分组出错。


### 无分类域间路由 CIDR
1. CIDR **消除了传统的 A 类、B 类和 C 类地址以及划分子网的概念**，因而可以更加有效地分配 IPv4 的地址空间。
2. CIDR使用各种长度的“网络前缀”(network-prefix)来代替分类地址中的网络号和子网号。（<u>让net-id长度也可变</u>）
3. **IP 地址从三级编址（使用子网掩码）又回到了两级编址。** 

<img src="https://i0.hdslb.com/bfs/album/581e8ad76cf9a5e132ab62ce57e92d8374718a87.png" alt="image-20211217200750412" style="zoom:50%;" />



#### **路由聚合**

> 一个 CIDR 地址块可以表示很多地址，这种地址的聚合常称为路由聚合

路由聚合有利于**<u>减少</u>**路由器之间的路由选择信息的交换，从而提高了整个互联网的性能。

+ 路由聚合也称为**构成超网 (supernetting)**。

<img src="https://i0.hdslb.com/bfs/album/f2068d462f37a91ffde29ff7777231ef69e51a22.png" alt="image-20211217201130388" style="zoom:50%;" />

### **最长前缀匹配**

​	使用 CIDR 时，路由表中的每个项目由“网络前缀”和“下一跳地址”组成。**<u>在查找路由表时可能会得到不止一个匹配结果</u>**。 
​	应当从匹配结果中选择具有最长网络前缀的路由：**最长前缀匹配 (longest-prefix matching)**。

> **最长前缀匹配**又称为**最长匹配**或**最佳匹配**。 



### 网际控制报文协议ICMP

> ICMP 允许主机或路由器**<u>报告差错情况</u>**和**<u>提供有关异常情况的报告</u>**。

但 ICMP 不是高层协议（看起来好像是高层协议，因为 ICMP 报文是装在 IP 数据报中，作为其中的数据部分），而是 <u>**IP 层的协议**</u>。

#### ICMP报文的种类

1. ICMP**差错报告**报文

   1. 终点不可达
   2. 时间超过
   3. 参数问题
   4. 改变路由（重定向）

2. ICMP**询问报文**
   1. 回送请求和回答报文
   2. 时间戳请求和回答报文

#### ICMP的应用举例：

+ PING: 用来测试两个主机之间的连通性
+ Tracerouter/tracert: 用来跟踪一个分组从源点到终点的路径



### 路由选择协议

“最佳路由”：所谓“最佳”只能是相对于**某一种特定要求下**得出的较为合理的选择而已。


#### 静态路由协议与动态路由选择协议

+ **静态路由选择策略**——即<u>非自适应路由选择</u>，其特点是简单和开销较小，但不能及时适应网络状态的变化。 (需要人为参与)

+ **动态路由选择策略**——即<u>自适应路由选择</u>，其特点是能较好地适应网络状态的变化，但实现起来较为复杂，开销也比较大。 （设计不好路由表会特别大）

#### 内部网关协议

内部网关协议 `IGP` (Interior Gateway Protocol)  
1. 在一个**自治系统内部使用**的路由选择协议。
2. 目前这类路由选择协议使用得最多，如 `RIP` 和 `OSPF` 协议。

#### 外部网关协议
外部网关协议 `EGP` (External Gateway Protocol) 
1. 若源站和目的站处在不同的自治系统中，当数据报传到一个自治系统的边界时，就需要使用一种协议**<u>将路由选择信息传递到另一个自治系统中</u>**。这样的协议就是外部网关协议 `EGP`。
2. 在外部网关协议中目前使用最多的是 `BGP-4`。 

<img src="https://i0.hdslb.com/bfs/album/cb9ca5d076f4b6dc87469870bb10fa638631bb2b.png" alt="image-20211217205150424" style="zoom: 50%;" />



#### 内部网关协议RIP

`RIP` 是一种**分布式的、基于距离向量**的路由选择协议。

+ RIP 协议要求网络中的**每一个路由器都要维护从它自己到其他每一个目的网络的距离记录**。 

##### RIP协议的三个特点
+ 和谁交换——**仅和<u>相邻路由器</u>交换信息**。 
+ 交换什么——**<u>交换的信息是当前本路由器所知道的全部信息</u>**，即自己的路由表。 
+ 交换频率——**按<u>固定的时间间隔</u>交换路由信息**，例如，每隔 30 秒。当网络拓扑发生变化时，路由器也及时向相邻路由器通告拓扑变化后的路由信息。

##### 路由表更新例题

<img src="https://i0.hdslb.com/bfs/album/682b27411b56231a0cfc14ed0c94dad9f71fb808.png" alt="image-20211217210803420" style="zoom:50%;" />

规则：

1. 首先将C发来的RIP报文进行更新，更新规则如下
   1. 将所有下一跳加一
   2. 将下一跳路由器全部变为C

2. 将发来更新后的路由器与当前路由器进行对比更新：规则如下
   1. 如果没有新的信息（不变）
   2. 如果有相同的下一跳（即使跳数变多），替换
   3. 存在新的一条路由，添加
   4. 不同下一跳，跳数变小，替换
   5. 不同下一跳，跳数相同，不变
   6. 不同下一跳，跳数变大，不变

#### RIP特点

>  **<u>好消息传播得快，坏消息传播得慢</u>**

当网络出现故障时，要经过比较长的时间 (例如数分钟) 才能将此信息传送到所有的路由器。

##### 优点

1. 实现简单，开销较小

##### 缺点

1. RIP 限制了网络的规模，它能使用的最大距离为 15（16 表示不可达）。
2. 路由器之间交换的路由信息是路由器中的完整路由表，**因而随着网络规模的扩大，开销也就增加**。
3. “坏消息传播得慢”，使更新过程的**收敛时间过长**



#### 内部网关协议OSPF

> 最短路径算法SPF


+ 和谁交换——<u>向本自治系统中所有路由器发送信息</u>，这里使用的方法是**<u>洪泛法</u>**。
+ 交换什么——发送的信息就是**<u>与本路由器相邻的所有路由器的链路状态</u>**，但这只是路由器所知道的部分信息。
- “链路状态”就是说明本路由器都和哪些路由器相邻，以及该链路的“度量”(metric)。 
+ 交换频率——**<u>只有当链路状态发生变化时，路由器才用洪泛法向所有路由器发送此信息</u>**（克服坏消息传的慢）。 



#### 外部网关协议BGP

> BGP 是<u>不同自治系统的路由器之间</u>交换路由信息的协议。 

1. 边界网关协议 BGP 只能是**力求寻找一条能够到达目的网络且比较好的路由**（不能兜圈子），<u>而并非要寻找一条最佳路由</u>。 

##### BGP 发言人 (BGP speaker)

​	两个 BGP 发言人都是通过一个共享网络连接在一起的，而 BGP 发言人往往就是 BGP 边界路由器，但也可以不是 BGP 边界路由器。 

<img src="https://i0.hdslb.com/bfs/album/772319483cfc25ee7da7b017c1e111ef5a33d6cb.png" alt="image-20211217213650180" style="zoom: 50%;" />

##### 特点

+ 和谁交换——**相邻BGP发言人之间互相交换信息**。<u>BGP 协议交换路由信息的结点数量级是自治系统数的量级</u>，这要比这些自治系统中的网络数少很多。
+ 交换什么——**交换发言人的路由表**。BGP 支持 CIDR，因此 BGP 的路由表也就应当包括<u>目的网络前缀、下一跳路由器，以及到达该目的网络所要经过的各个自治系统序列</u>。
+ 交换频率——在 BGP 刚刚运行时，BGP 的邻站是交换整个的 BGP 路由表。但以后只需要在发生变化时<u>更新有变化的部分。这样做对节省网络带宽和减少路由器的处理开销都有好处。</u> 

#### 路由器的构成
路由器的主要作用是：
+ 连通不同的网络
+ 选择信息传送的线路

#### “转发”和“路由选择”的区别

**“转发”(forwarding)** 就是路由器根据转发表将用户的 IP 数据报从合适的端口转发出去。
**“路由选择”(routing)** 则是按照分布式算法，根据从各相邻路由器得到的关于网络拓扑的变化情况，动态地改变所选择的路由。

> <u>路由表（宏观选择路径）是根据路由选择算法得出的。而转发表是从路由表得出的</u>。

#### IPV6

变化：

1. IPv6 仍**<u>支持无连接的传送</u>**，但将**协议数据单元 PDU 称为分组**。

2. 更大的地址空间（`32位`增加到`128位`）

3. 拓展的地址层次结构
4. 灵活的首部格式（定义了许多可选的拓展首部）
5. 改进的选项（IPv6允许数据报包含有选项的控制信息，其选项放在有效载荷中）

6. 允许协议继续扩充
7. 支持即插即用（自动配置，无需DHCP）
8. 支持资源的预分配
9. IPv6首部改为8字节对齐。

##### IPv6 数据报由两大部分组成
+ **基本首部** (base header)：IPv6 将首部长度变为固定的 40 字节，称为基本首部。

+ **有效载荷** (payload)。有效载荷也称为净负荷。<u>有效载荷允许有零个或多个扩展首部</u>，再后面是数据部分。

<img src="https://i0.hdslb.com/bfs/album/29461e3f5abdd5883c9092ae431750c996459237.png" alt="image-20211217222037630" style="zoom:50%;" />

##### IPv4与IPv6的对比

<img src="https://i0.hdslb.com/bfs/album/bb223f0f81ddfba8672feeb3175de9264e1a705c.png" alt="image-20211217222550651" style="zoom:50%;" />

IPv4数据报格式

<img src="https://i0.hdslb.com/bfs/album/6fddabce7cc541ff8415cb9f12b68fba458a6b79.png" alt="image-20211217222756529" style="zoom:50%;" />

**IPv6数据报格式**

<img src="https://i0.hdslb.com/bfs/album/95ed3c163e6ccdde6efea8d625cd48820cccaa0e.png" alt="image-20211217222834753" style="zoom:50%;" />


+ **版本**(version)—— 4 位。它指明了协议的版本，对 IPv6 该字段总是 6。 
+ **通信量类**(traffic class)—— 8 位。这是<u>**为了区分不同的 IPv6 数据报的类别或优先级**</u>。目前正在进行不同的通信量类性能的实验。 
+ **流标号(**flow label)—— 20 位。 “流”**是互联网络上从特定源点到特定终点的一系列数据报**， “流”所经过的路径上的路由器都保证指明的服务质量。**<u>所有属于同一个流的数据报都具有同样的流标号</u>**。 
+ 有效载荷长度(payload length)—— 16 位。它指明 **<u>IPv6 数据报除基本首部以外的字节数（所有扩展首部都算在有效载荷之内），其最大值是 64 KB</u>**。 
+ 下一个首部(next header)—— 8 位。**连接有效载荷里的下个首部**（类似链表）。 
+ 跳数限制(hop limit)—— 8 位。源站在数据报发出时即设定跳数限制。路由器在转发数据报时将跳数限制字段中的值减 1。当跳数限制的值为零时，就要将此数据报丢弃。 
+ 源地址—— **128 位**。是数据报的发送站的 IP 地址。 
+ 目的地址—— **128 位**。是数据报的接收站的 IP 地址。 

> 数据报途中经过的路由器都不处理这些扩展首部， 大大提高了路由器的处理效率。

#### 零压缩

> 在任一地址中只能使用一次零压缩。



### 虚拟专用网VPN

+ 本地地址——**仅在机构内部使用的 IP 地址**，可以由本机构自行分配，而不需要向互联网的管理机构申请。
+ 全球地址——**全球唯一的 IP 地址**，必须向互联网的管理机构申请。 

> RFC 1918 指明了一些**专用地址** (private address)。<u>专用地址只能用作本地地址</u>而不能用作全球地址。**<u>在互联网中的所有路由器，对目的地址是专用地址的数据报一律不进行转发。</u>**

<img src="https://i0.hdslb.com/bfs/album/89baee75242ee4cb81884022139999ce048e2f2a.png" alt="image-20211217224057638" style="zoom: 50%;" />

> “专用网”是因为这种网络是为<u>本机构的主机用于机构内部的通信</u>，而不是用于和网络外非本机构的主机通信。



### 网络地址转换NAT

> NAT 路由器上将其本地地址转换成全球 IP 地址





## 传输层

1. 运输层协议概述（进程之间的通信，运输层的端口）
2. 用户数据报协议 UDP（特点、首部格式）
3. 传输控制协议 TCP（特点、套接字、可靠传输的工作原理、首部格式）
4. TCP 的流量控制和 TCP 的拥塞控制
5. TCP 的运输连接管理（连接的建立和释放）



### 运输层协议概述

+ 运输层属于**<u>面向通信部分的最高层</u>**，同时也是**<u>用户功能中的最低层</u>**

+ 运输层：网络边缘两个主机使用网络的核心部分的功能进行**端到端的通信**时，<u>只有位于网络边缘部分的主机的协议栈才有运输层</u>；而网络核心部分中的**路由器在转发分组时**都<u>只用到下三层的功能</u>。

  > 通信的真正端点并不是主机，而是<u>主机中的进程</u>



#### 端系统之间通信的含义

​	“主机A和主机B进行通信”实际上是指：“**<u>运行在主机A上的某个程序和运行在主机B上的另一个程序进行通信</u>**”。端到端的通信是**进程之间的通信**。

<img src="https://i0.hdslb.com/bfs/album/5397e527c31b3d23236b3a0024a2a747cf145ec8.png" alt="image-20211223110034847" style="zoom: 50%;" />

> ​	运输层向高层用户**屏蔽了下面网络核心的细节**，它使应用进程看见的就是**好像**在两个运输层实体之间有一条<u>**端到端的逻辑通信信道**</u>。



#### 运输层的端口

+ 计算机中的进程是用**<u>进程标识符</u>**来标志的


> 运输层使用协议端口号 (protocol port number)，或通常简称为**端口** (port)

+  端口号只具有**本地意义**，即端口号只是<u>为了标志本计算机应用层中的各进程</u>。在互联网中，不同计算机的相同端口号是没有联系的。



#### 运输协议

+ 面向连接的 TCP 协议（**传输控制协议**）
  + 尽管下面的**网络是不可靠的（只提供尽最大努力服务）**，但这种**逻辑通信信道**就相当于一条**可靠信道**。
+ 采用无连接的 UDP 协议（**用户数据报协议**）
  + **逻辑通信信道**是一条**不可靠信道**



<img src="https://i0.hdslb.com/bfs/album/924263857634cb9cf965c23b11b25411c850d665.png" alt="image-20211223110812268" style="zoom: 50%;" />



##### TCP与UDP

两个对等运输实体在通信时传送的数据单位叫作**<u>运输协议数据单元 TPDU (Transport Protocol Data Unit)</u>**。

+ TCP 传送的数据单位协议是**TCP报文段(segment)**。
+ UDP 传送的数据单位协议是**UDP报文**或**用户数据报**。 

<img src="https://i0.hdslb.com/bfs/album/44cdb6e456c445232f00795f9028aa1a13df3897.png" alt="image-20211223111031720" style="zoom: 50%;" />



### 用户数据报协议UDP

#### UDP特点

1. **<u>UDP 是无连接的</u>**，发送数据之前不需要建立连接，因此减少了开销和发送数据之前的时延。
2. **<u>UDP 使用尽最大努力交付</u>**，即不保证可靠交付，因此主机不需要维持复杂的连接状态表。
3. **<u>UDP 是面向报文的</u>**。UDP 对应用层交下来的报文，既不合并，也不拆分，而是保留这些报文的边界。**UDP 一次交付一个完整的报文**。即应用层交给 UDP 多长的报文，UDP 就照样发送。
4. **<u>UDP 没有拥塞控制</u>**，因此网络出现的拥塞不会使源主机的发送速率降低。这对某些实时应用是很重要的。很适合多媒体通信的要求。 
5. **<u>UDP 支持一对一、一对多、多对一和多对多的交互通信。</u>**
6. **<u>UDP 的首部开销小</u>**，只有 8 个字节，比 TCP 的 20 个字节的首部要短。

#### UDP首部格式

<img src="https://i0.hdslb.com/bfs/album/7e872df49fcf93c6584742fee13429038fdb2bac.png" alt="image-20211223130229942" style="zoom:50%;" />

### 传输控制协议TCP

#### 特点

主要特点💖

1. TCP 是**<u>面向连接</u>**的运输层协议，在无连接的、不可靠的 IP 网络服务基础之上提供**<u>可靠交付</u>**的服务<u>**（`无差错`、`不丢失`、`不重复`并且`按序到达`）**</u>。

2. 每一条 TCP 连接**只能有两个端点 (endpoint)**，每一条 TCP 连接**<u>只能是点对点的（一对一），不能进行多播和广播（一对多）</u>**。 

3. TCP 提供**全双工通信**。

4. **<u>面向字节流</u>**

    1. TCP <u>不保证</u>接收方应用程序所收到的数据块和发送方应用程序所发出的**<u>数据块具有对应大小的关系</u>**。

    1. > “面向字节流”的含义是：虽然应用程序和 TCP 的交互是一次一个数据块，但 TCP 把应用程序交下来的数据看成仅仅是一连串**无结构的字节流**。

          1. TCP **不保证**<u>接收方应用程序所收到的数据块</u>和<u>发送方应用程序所发出的数据块</u>具有对应大小的关系。

          2. 但**<u>接收方应用程序收到的字节流必须和发送方应用程序发出的字节流完全一样</u>**。

<img src="https://i0.hdslb.com/bfs/album/d0bebc7d79d238c91f974636a9b36126da97abf0.png" alt="image-20211223133443957" style="zoom: 50%;" />

##### 套接字socket


​	TCP 连接的端点不是主机，不是主机的IP 地址，不是应用进程，也不是运输层的协议端口。**TCP 连接的端点叫做套接字 (socket)** 。

<u>端口号拼接到 IP 地址即构成了套接字</u>
$$
套\, 接\, 字 \, socket = (IP\, 地\, 址 : 端\, 口\, 号)
$$

每一条 TCP 连接**唯一地**被通信两端的**两个端点**（即两个套接字）所确定。

$$
TCP\, 连\, 接 ::= \left\{ socket1,socket2 \right\} =\left\{(IP1:port1),\;(IP2:port2)\right\}
$$

### TCP可靠传输的运输原理⭐

#### 停止等待协议

+ `停止等待`就是**每发送完一个分组就停止发送，等待对方的确认；在收到确认后再发送下一个分组**。
+ **全双工通信**的双方既是发送方也是接收方。



<img src="https://i0.hdslb.com/bfs/album/a8b024608b598b76653a7ba54e009ab9bad26e4a.png" alt="image-20211223141503304" style="zoom:50%;" />

##### 当接收方B收到的A发送的信息有差错

+ 情况一：$B$ 接收 $M_1$ 时检测出了差错，就丢弃 $M_1$，其他**什么也不做**（不通知 $A$ 收到有差错的分组）。
+ 情况二：$M_1$ 在传输过程中丢失了，这时 $B$ 当然什么都不知道，也**什么都不做**。

> $B$都不会发送任何信息，此时A必须重发分组（<u>**超时重传**</u>），直到*B*接受正确

<img src="https://i0.hdslb.com/bfs/album/7f821909a1504e5b1cfcf5ae94d5a55558b5f3c6.png" alt="image-20211223142209291" style="zoom:50%;" />



##### 确认丢失和确认迟到

###### 确认丢失

若 B 所发送的对 M1 的确认丢失了，那么 A 在设定的超时重传时间内不能收到确认，但 A 并无法知道：是自己发送的分组出错、丢失了，或者是 B 发送的确认丢失了。因此 **A 在超时计时器到期后就要重传 M1**。

B采取的行动：

1. **丢弃**这个重复的分组 M1，不向上层交付。
2. **向 A 发送确认**。不能认为已经发送过确认就不再发送，因为 A 之所以重传 M1 就表示 A 没有收到对 M1 的确认。



###### 确认迟到

1. 传输过程中没有出现差错，但 **B 对分组 M1 的确认**<u>迟到了</u>。
2. A 会收到重复的确认。<u>对重复的确认的处理很简单：**收下后就丢弃**</u>。
3. B 仍然会收到重复的 M1，并且同样要<u>**丢弃重复的 M1（编号）**</u>，并**<u>重传确认</u>**分组。

<img src="https://i0.hdslb.com/bfs/album/26a8e529ae1fac89a8a2eedd147f72d30b371c9f.png" alt="image-20211223144813795" style="zoom:50%;" />

> **分组**和**确认分组**都<u>必须进行编号</u>。



<u>使用上述的**确认和重传机制**，我们就可以在不可靠的传输网络上实现可靠的通信。</u>这种可靠传输协议常称为**自动重传请求**ARQ(Automatic Repeat reQuest)



### 停止等待协议要点

+ **<u>停止等待</u>**。发送方每次只发送一个分组。在收到确认后再发送下一个分组。

+ **<u>编号</u>**。对发送的每个**分组和确认**都进行编号。

+ **<u>自动重传请求</u>**。发送方为每个发送的分组设置一个超时计时器。若超时计时器超时，发送方会自动重传分组。

> 简单，但信道利用率太低


#### 信道利用率

往返时间RTT 、分组发送时间$T_D$ 

<img src="https://i0.hdslb.com/bfs/album/52e7763bdd386b5491fde53a8a98f6020fd70e10.png" alt="image-20211223151122382" style="zoom:50%;" />



#### 连续ARQ协议

**基本思想**：

+ 发送方一次可以**发出多个分组（滑动窗口）**。
+ 使用**<u>滑动窗口协议</u>**控制发送方和接收方所能发送和接收的分组的数量和编号。
+ 每收到一个确认，发送方就把发送窗口**向前滑动**。
+ 接收方一般采用**<u>累积确认</u>**的方式。
+ 采用**<u>回退N（Go-Back-N）方法进行重传</u>**。



​	发送方维持的**发送窗口**，它的意义是：**<u>位于发送窗口内的分组都可连续发送出去，而不需要等待对方的确认。</u>**这样，信道利用率就提高了。
​	连续 ARQ 协议规定，**<u>发送方每收到一个确认，就把发送窗口向前滑动一个分组的位置</u>**。



可靠通信的**具体实现**：

1. TCP 连接的每一端都必须设有两个窗口——一个`发送窗口`和一个`接收窗口`。
2. TCP 的可靠传输机制用`字节`的序号进行控制。**<u>TCP 所有的确认都是基于序号而不是基于报文段</u>**。
3. TCP 两端的**四个窗口经常处于动态变化**之中。
4. TCP连接的`往返时间 RTT `也不是固定不变的。需要**使用特定的算法估算较为合理的重传时间**。 



<img src="https://i0.hdslb.com/bfs/album/2eabd77e099883639899e843b606d58e47a73626.png" alt="image-20211223153009943" style="zoom:50%;" />



<img src="C:\Users\yuban\AppData\Roaming\Typora\typora-user-images\image-20211223153032496.png" alt="image-20211223153032496" style="zoom:50%;" />



<img src="C:\Users\yuban\AppData\Roaming\Typora\typora-user-images\image-20211223153048633.png" alt="image-20211223153048633" style="zoom: 50%;" />

<img src="C:\Users\yuban\AppData\Roaming\Typora\typora-user-images\image-20211223153118125.png" alt="image-20211223153118125" style="zoom:50%;" />

**累积确认**

​	接收方一般采用**累积确认**的方式。即**<u>不必对收到的分组逐个发送确认，而是对按序到达的最后一个分组发送确认</u>**，这样就表示：**到这个分组为止的所有分组都已正确收到了**。

<img src="https://i0.hdslb.com/bfs/album/7a0e0a70e54ec28fdcc06d8dcf81498f9c2e53b1.png" alt="image-20211223153600511" style="zoom:50%;" />

**Go-back-N（回退N）**

​		如果发送方发送了前 5 个分组，而中间的第 3 个分组丢失了。这时**接收方只能对前两个分组发出确认**。发送方无法知道后面三个分组的下落，而**只好把后面的三个分组都再重传一次**。
​		这就叫做 Go-back-N（回退 N），表示**<u>需要再退回来重传已发送过的 N 个分组</u>**。

<img src="https://i0.hdslb.com/bfs/album/caa293cb36811623ec4d448151223cee699483ac.png" alt="image-20211223154110391" style="zoom: 50%;" />

#### 连续ARQ协议与停止等待协议对比

<img src="https://i0.hdslb.com/bfs/album/a30927e478eba24486ccefe3eb88a7a18aed17e9.png" alt="image-20211223154314595" style="zoom: 50%;" />



### TCP报文段首部格式

​	TCP 首部的**最小长度是 20 字节**。

<img src="https://i0.hdslb.com/bfs/album/1fd97bf1fd7d5f11b4e49015d7cd5708f4eb1c11.png" alt="image-20211223160912587" style="zoom:50%;" />

**序号字段**的值则指的是**本报文段所发送的数据的第一个字节的序号**

> TCP 连接中传送的数据流中的每一个字节都编上一个序号

**确认号字段**：是<u>期望收到对方的下一个报文段的数据的第一个字节的序号</u>。

**数据偏移（即首部长度）**：它指出 **TCP 报文段的数据起始处**距离 **TCP 报文段的起始处**有多远。

+ “数据偏移”的单位是 32 位字（以 <u>4 字节</u>为计算单位）。 

**紧急 `URG`** ：当 URG=1 时，表明紧急指针字段有效。它告诉系统此报文段中有紧急数据，应尽快传送(相当于高优先级的数据)。 

**确认 `ACK`** ：只有当 ACK =1 时确认号字段才有效。当 ACK =0 时，确认号无效。 

**推送 `PSH` (PuSH)** ：  接收 TCP 收到 PSH = 1 的报文段，就<u>尽快地交付接收应用进程</u>，而不再等到整个缓存都填满了后再向上交付。 

**复位 `RST` (ReSeT)** ： 当 RST=1 时，表明 TCP 连接中出现严重差错（如由于主机崩溃或其他原因），**必须释放连接，然后再重新建立运输连接**。 

**同步 `SYN`**： 同步 SYN = 1 表示这是一个<u>**连接请求**</u>或<u>**连接接受报文**</u>。 

**终止 `FIN` (FINish)** ： 用来<u>**释放一个连接**</u>。FIN=1 表明此报文段的发送端的数据已发送完毕，并要求释放运输连接。 

**窗口字段** ：用来让对方设置发送窗口的依据，单位为字节。

**检验和** ： **检验和字段检验的范围包括首部和数据这两部分**。在计算检验和时，要在 TCP 报文段的前面加上 12 字节的伪首部。

<img src="https://i0.hdslb.com/bfs/album/684e3175c913025a8308e0defa8a1b41d7b79d71.png" alt="image-20211223162317727" style="zoom:33%;" />

**紧急指针字段** : 指出在本报文段中紧急数据共有多少个字节（URG=1，紧急数据放在本报文段数据的最前面）。 

**MSS (Maximum Segment Size)**：是TCP报文段中的数据字段的最大长度。

**填充字段** ： 这是为了使整个首部长度是**4字节的整数倍**。



<u>序号字段例题</u>

<img src="https://i0.hdslb.com/bfs/album/fe89a003994e72d55a8c0c74f63f2e1678b63ec8.png" alt="image-20211223161340302" style="zoom: 33%;" />



### TCP流量控制

#### 利用滑动窗口实现流量控制

+ 流量控制 (flow control) 就是让发送方的发送速率不要太快，<u>既要让接收方来得及接收，也不要使网络发生拥塞</u>。



`rwnd` 表示接收窗口的大小

![image-20211223170708288](https://i0.hdslb.com/bfs/album/b177dcb0e2e15806595324b37c69943ef6b52108.png)



#### 传输效率

糊涂窗口综合征：<u>每次仅发送一个字节或很少几个字节的数据时，有效数据传输效率变得很低的现象。</u>

##### 发送方糊涂窗口综合征

> 产生数据的速率慢

​	发送方 TCP 每次接收到`一字节`的数据后就发送。这样，发送一个字节需要形成 41 字节长的 IP 数据报。效率很低。
​	解决方法：使用 <u>Nagle 算法</u>。

1. 第一种机制是 TCP 维持一个变量，它等于最大报文段长度 MSS。只要缓存中**<u>存放的数据达到 MSS 字节时，就组装成一个 TCP 报文段发送出去</u>**。
2. 第二种机制是由发送方的应用进程**<u>指明要求发送报文段</u>**，即 TCP 支持的推送 (`push`) 操作。
3. 第三种机制是发送方的一个计时器期限到了，这时就把当前已有的缓存数据装入报文段（但长度不能超过 MSS）发送出去。



<img src="https://i0.hdslb.com/bfs/album/ec7ac54829779826ee0bb4535612849c42ad46c1.png" alt="image-20211223172739299" style="zoom: 50%;" />

##### 接受方糊涂窗口综合征

> 消耗数据的速率慢


​	当接收方的 <u>TCP 缓冲区已满</u>，接收方会向发送方发送窗口大小为 0 的报文。

​	若此时接收方的应用进程以交互方式每次只读取一个字节，于是接收方又发送窗口大小为一个字节的更新报文，发送方应邀发送一个字节的数据（发送的 IP 数据报是 41 字节长），于是接收窗口又满了，如此循环往复。

<img src="https://i0.hdslb.com/bfs/album/bf5c5c75f77b87ec4c07a9ce4db8c027173484c1.png" alt="image-20211223192346220" style="zoom:50%;" />

**解决方法**：让接收方等待一段时间，使得或者**接收缓存已有足够空间容纳一个最长的报文段**，或者**等到接收缓存已有一半空闲的空间**。只要出现这两种情况之一，接收方就发出确认报文，并向发送方通知当前的窗口大小。



### TCP的拥塞控制

​	在某段时间，若对网络中某资源的需求超过了该资源所能提供的可用部分，网络的性能就要变坏。这种现象称为<u>拥塞 (congestion)</u>。

<img src="https://i0.hdslb.com/bfs/album/6e8f4dfed00f10afbc5dcfebbb1b750b2408267b.png" alt="image-20211223192951512" style="zoom:33%;" />

#### 拥塞控制与流量控制的区别

<img src="https://i0.hdslb.com/bfs/album/158a5ee25b0a7bd1099fd4641c92dc4fec7eb281.png" alt="image-20211223193029502" style="zoom: 33%;" />

网络拥塞往往是由许多因素引起的：

1. **增大缓存，但未提高输出链路的容量和处理机的速度，排队等待时间将会大大增加**，引起大量超时重传，解决不了网络拥塞；

2. 提高处理机处理的速率会将瓶颈转移到其他地方；

#### 开环控制和闭环控制

**开环控制**：

​	思路：力争**避免发生拥塞**。

**闭环控制**：基于反馈环路的概念

​	思路：在发生拥塞后，**采取措施进行控制，消除拥塞**。



#### TCP 的拥塞控制方法
+ TCP 采用**基于窗口的方法**进行拥塞控制。该方法属于**闭环控制**方法。
+ TCP发送方维持一个拥塞窗口 `cwnd` (Congestion Window)
+ 发送端利用拥塞窗口，**根据网络的拥塞情况调整发送的数据量**。
+ 发送窗口大小不仅取决于接收方窗口，还取决于网络的拥塞状况，所以真正的发送窗口值为：

$$
真\,正\,的\,发\,送\,窗\,口\,值 = Min (接\,收\,方\,窗\,口\,值\,，拥\,塞\,窗\,口\,值)
$$

**拥塞的判断**
收到三个重复的ACK:**<u>预示网络可能会出现拥塞</u>**。（实际可能还未发生拥塞）

####  TCP拥塞控制算法

+ 慢开始 (slow-start)
+ 拥塞避免 (congestion avoidance)
+ 快重传 (fast retransmit)
+ 快恢复 (fast recovery)

**慢开始**（窗口以指数方式增加）

<img src="https://i0.hdslb.com/bfs/album/651d48e1a58020f4e780487a51bce804a716c4b3.png" alt="image-20211223194421406" style="zoom:33%;" />

<img src="https://i0.hdslb.com/bfs/album/9d9241f5f650e50f1552dbe6fe5ebfa459e5908e.png" alt="image-20211223194526113" style="zoom:33%;" />

**拥塞避免**（阻塞窗口以线性方式增加）

<img src="https://i0.hdslb.com/bfs/album/406a99c3b4a15468ed5b94b3ede8c4d31343793a.png" alt="image-20211223194750853" style="zoom:33%;" />



**网络出现拥塞**（重新计算阻塞窗口和慢开始门限）

​	无论在慢开始阶段还是在拥塞避免阶段，只要**发送方判断网络出现拥塞**（重传定时器超时）：
1. $ssthresh = max (\dfrac{cwnd}{2}，2)$
2. $cwnd = 1$
3. 执行`慢开始`算法
> 目的：**迅速减少**主机发送到网络中的分组数，使得发生拥塞的路由器有足够时间把队列中积压的分组处理完毕。 



**快重传**

​	发送方只要**<u>一连收到三个重复确认</u>**，就知道接收方确实没有收到报文段，因而应当立即进行重传（即“快重传”）。

>  使用快重传可以使整个网络的吞吐量提高约20%。 

<img src="https://i0.hdslb.com/bfs/album/62d204775f8dea4d17693b6aeefd2799310a3a66.png" alt="image-20211223195508576" style="zoom:33%;" />

**快恢复**（阻塞窗口减半，慢开始门限等于新阻塞窗口）
	**发送端收到连续三个重复的确认**时，由于发送方现在认为网络很可能没有发生拥塞，因此现在不执行慢开始算法，而是执行<u>**快恢复算法 FR (Fast Recovery)**</u> 算法：

1. $慢\,开\,始\,门\,限\, ssthresh = 当\,前\,拥\,塞\,窗\,口\, \dfrac{cwnd }{2}$ ；
2. $新\,拥\,塞\,窗\,口\, cwnd = 慢\,开\,始\,门\,限\, ssthresh $；
3. 开始执行拥塞避免算法，使拥塞窗口缓慢地线性增大。



<img src="https://i0.hdslb.com/bfs/album/bb6a515ada3d2c231a64293006722f065ddf732f.png" alt="image-20211223195853087" style="zoom:50%;" />

##### TCP拥塞控制流程图

<img src="https://i0.hdslb.com/bfs/album/dfec7e11eb74e5298521e511d80638786bf6081e.png" alt="image-20211223200622520" style="zoom:50%;" />

### TCP的运输连接管理

TCP的连接建立

<img src="https://i0.hdslb.com/bfs/album/e1a06962b81277c8c6c13a08a3105c37164fe25d.png" alt="image-20211223225817440" style="zoom: 50%;" />

1. B的TCP服务器进程创建传输控制块TCP，准备接受客户端进程的连接请求。
2. A的TCP向向 B 发出连接请求报文段，其首部中的同步位 SYN = 1，并选择序号 seq = x，表明传送数据时的第一个数据字节的序号是 x。
3. B 的 TCP 收到连接请求报文段后，如同意，则发回确认。B 在确认报文段中应使 SYN = 1，使 ACK = 1，其确认号 ack = x + 1，自己选择的序号 seq = y。
4. A 收到此报文段后向 B 给出确认，其 ACK = 1，确认号 ack = y + 1。A 的 TCP 通知上层应用进程，连接已经建立。 
5. B 的 TCP 收到主机 A 的确认后，也通知其上层应用进程：TCP 连接已经建立。


TCP的连接释放

<img src="https://i0.hdslb.com/bfs/album/412565d460826ac075c356645af009308c928f58.png" alt="image-20211223230154500" style="zoom: 50%;" />

1. 数据传输结束后，通信的双方都可释放连接。 现在 A 的应用进程先向其 TCP 发出连接释放报文段，并停止再发送数据，主动关闭 TCP 连接。A 把连接释放报文段首部的FIN = 1，其序号seq = u，等待 B 的确认。
2. B 发出确认，确认号 ack = u+1，而这个报文段自己的序号 seq = v。TCP 服务器进程通知高层应用进程。从 A 到 B 这个方向的连接就释放了，TCP 连接处于半关闭状态。B 若发送数据，A 仍要接收。
3. 若 B 已经没有要向 A 发送的数据，其应用进程就通知 TCP 释放连接。
4. A 收到连接释放报文段后，必须发出确认。在确认报文段中ACK = 1，确认号 ack = w + 1，自己的序号 seq = u + 1。 


## 应用层

1. 域名系统 DNS
2. 文件传送协议 FTP 和远程终端协议 TELNET
3. 万维网 WWW 和电子邮件

### 域名系统 DNS (Domain Name System) 
+ 互联网采用了层次树状结构的命名方法。

+ 域名的结构由标号序列组成，各标号之间用点隔开：
$$
...... . 三\,级\,域\,名\, .\, 二\,级\,域\,名\, .\, 顶\,级\,域\,名
$$

> 没有一级域名

|   顶级域名   | 说明     |
| ---- | ---- |
|   .com   |  公司和企业    |
|  .net    |   网络服务机构   |
|   .org   |   非赢利性组织   |
|  .edu    |  美国专用的教育机构   |
|   .gov   |  美国专用的政府部门    |
|    .mil  |    美国专用的军事部门  |
|   .int   |   国际组织   |
| .cn |中国|
|.us |美国|



<img src="https://i0.hdslb.com/bfs/album/9ae9d9d767c538a9064b0a7a3dcd5a071517b5d8.png" alt="image-20211223231830615" style="zoom:33%;" />



+ DNS 服务器的管辖范围不是以`域`为单位，而是以`区`为单位
+ 每一个区设置相应的权限域名服务器，用来保存该区中的所有主机的域名到 IP 地址的映射。


#### 区的不同划分

<img src="https://i0.hdslb.com/bfs/album/c7ee564f9b02f93ffa543deac75fba4ecbd5ebda.png" alt="image-20211223232007846" style="zoom:50%;" />



#### 域名服务器的类型

+ 根域名服务器 
+ 顶级域名服务器 
+ 权限域名服务器 
+ 本地域名服务器 

<img src="https://i0.hdslb.com/bfs/album/7a71ef437c5dd7a1f6cacf3feab69b85ded46afa.png" alt="image-20211223232230278" style="zoom:33%;" />



##### 根域名服务器

​		根域名服务器是最高层次的域名服务器，也是最重要的域名服务器。**<u>所有的根域名服务器都知道所有的顶级域名服务器的域名和 IP 地址。</u>**
​		不管是哪一个本地域名服务器，若要对互联网上任何一个域名进行解析，<u>只要自己无法解析，就**首先求助于根域名服务器**</u>。

##### 顶级域名服务器


顶级域名服务器，<u>负责管理在该顶级域名服务器注册的所有二级域名</u>。

##### 权限域名服务器

**负责一个区的域名服务器**



#### **域名的解析过程**

1. **主机**向**本地域名服务器**的查询一般都是采用**递归查询**

<img src="https://i0.hdslb.com/bfs/album/1c6ee3174627806e2ee5ae74ba174591b77a07a0.png" alt="image-20211223232655909" style="zoom:33%;" />


2. **本地域名服务器**向**根域名服务器**的查询通常是采用**迭代查询**

<img src="https://i0.hdslb.com/bfs/album/bc7261481bb2bc8e6539988abcbddf5c323aaefc.png" alt="image-20211223232720551" style="zoom:33%;" />

### **文件传送协议** **FTP (File Transfer Protocol)**

> FTP 屏蔽了各计算机系统的细节，因而适合于在异构网络中任意计算机之间传送文件。

+ TCP可靠传输
+ 功能：**减少或消除在不同操作系统下处理文件的不兼容性**
+ **客户-服务器方式**：一个 FTP 服务器进程可**同时为多个客户进程提供服务**。FTP 的服务器进程由两大部分组成：一个**主进程**，<u>负责接受新的请求</u>；另外有若干个**从属进程**，<u>负责处理单个请求</u>。

### **远程终端协议** **TELNET**

+ 和 FTP 的情况相似，服务器中的**主进程等待新的请求**，并产生**从属进程来处理每一个连接**。 

### 万维网WWW**(World Wide Web)**

> 万维网是一个大规模的、联机式的信息储藏所。

+ 万维网以**<u>客户 - 服务器</u>**方式工作

#### URL

+ 使用<u>统一资源定位符 URL (Uniform Resource Locator)</u> 来标志万维网上的各种文档。
+ 使每一个文档在整个互联网的范围内具有唯一的标识符 URL。 
+ 格式

$$
<\,协\,议\,>://<\,主\,机\,>:<\,端\,口\,>/<\,路\,径\,>>
$$



#### HTTP

+ 在万维网客户程序与万维网服务器程序之间进行交互所使用的协议，是**<u>超文本传送协议 HTTP (HyperText Transfer Protocol)</u>**。
+ HTTP 是一个**应用层**协议，它使用 **TCP 连接**进行**<u>可靠</u>**的传送。 

##### **HTTP** **的报文结构**

+ **请求报文**：从客户向服务器发送请求报文
+ **响应报文**：从服务器到客户的回答

|   方法（操作）   |    意义  |
| :--: | :--- |
| OPTION     |  请求一些选项的信息    |
|   GET    |  请求读取由 URL所标志的信息    |
|   HEAD   |   请求读取由 URL所标志的信息的首部   |
|  POST    |   给服务器添加信息（例如，注释）   |
|  PUT    |   在指明的 URL下存储一个文档   |
|  DELETE    |  删除指明的 URL所标志的资源    |
|  TRACE    |    用来进行环回测试的请求报文  |
|  CONNECT    |   用于代理服务器   |



Cookie 表示在 HTTP 服务器和客户之间传递的状态信息



#### HTML

​	**<u>超文本标记语言 HTML (HyperText Markup Language)</u>** 使得万维网页面的设计者可以很方便地用一个超链从本页面的某处链接到互联网上的任何一个万维网页面，并且能够在自己的计算机屏幕上将这些页面显示出来。 

​	但 XML 的设计宗旨是传输数据，而不是显示数据（HTML 是为了在浏览器上显示数据）



### 电子邮件

电子邮件的组成：三个主要构件

+ 用户
+ 用户代理
+ 邮件服务器

<img src="https://i0.hdslb.com/bfs/album/2ca4c6f9eb9ae49698d4f0e513147b47393cdbcf.png" alt="image-20211224104614690" style="zoom: 50%;" />

**<u>简单邮件发送协议 SMTP（Simple Mail Transfer Protocol ）</u>**：用于在用户代理向邮件服务器或邮件服务器之间发送邮件。
<u>**邮局协议 POP3（Post Office Protocol）**</u>：用于用户代理从邮件服务器读取邮件。

> SMTP和POP3（或IMAP）都是使用<u>TCP连接</u>来传送邮件的，目的是为了可靠地传送邮件。



##### 邮件读取协议 POP3 和 IMAP



+ POP3：邮局协议 (Post Office Protocol) 第3个版本 
+ IMAP：网际报文存取协议 (Internet Message Access Protocol)



## 网络安全

1. 网络安全问题概述，计算机网络上的与通信有关的四种威胁
2. 两类密码体制（对称密钥密码体制、公钥密码体制）
3. 数字签名和鉴别

### 计算机网络面临的威胁

计算机网络上的通信面临以下两大类威胁：**<u>被动攻击</u>**和**<u>主动攻击</u>**。

+ 截获
+ 篡改
+ 恶意程序
+ 拒绝服务

<img src="https://i0.hdslb.com/bfs/album/9600f14263cffb817958757cb5d4e27e0b998ee0.png" alt="image-20211224105329932" style="zoom: 33%;" />

#### 分布式拒绝服务 DDoS

​	若从互联网上的成百上千的网站集中攻击一个网站，则称为**<u>分布式拒绝服务 DDoS (Distributed Denial of Service)</u>**。有时也把这种攻击称为**网络带宽攻击**或**连通性攻击**。


对付被动攻击

+ 各种数据加密技术

对付主动攻击

+ 加密技术

+ 鉴别技术

### 两类密码体制

#### **对称密钥密码体制**

+ 所谓常规密钥密码体制，即**加密密钥与解密密钥是相同的密码体制**。
+ 这种加密系统又称为<u>对称密钥系统</u>。

<img src="https://i0.hdslb.com/bfs/album/21be515e2e3323d71e246d356e9c9e0225a4af16.png" alt="image-20211224110556357" style="zoom:50%;" />

##### 数据加密标准 DES

> DES属于对称密钥密码体制

+ DES 的保密性仅取决于对**密钥的保密**，其算法是公开的。

<center>三重DES</center>

<img src="https://i0.hdslb.com/bfs/album/774367b166d709ba779422334f0422b12e4e9d0d.png" alt="image-20211224110926470" style="zoom:50%;" />


$$
Y = DES_{K_1}\left(DES^{-1}_{K_2}\left(DES_{K_1}\left(X\right)\right)\right)
$$


#### **公钥密码体制**

​	公钥密码体制（又称为公开密钥密码体制）使用**不同的加密密钥与解密密钥**，是一种“由已知加密密钥推导出解密密钥在计算上是不可行的”密码体制。 


公钥密码体制产生的主要原因：
1. 常规密钥密码体制的密钥分配问题。
2. 对数字签名的需求。



​	在公钥密码体制中，加密密钥 $PK$（public key，即公钥）是向公众公开的，而解密密钥 $SK$（secret key，即私钥或秘钥）则是需要保密的。
+ 加密算法 E 和解密算法 D 也都是公开的。
+ <u>私钥 *SK* 是由公钥 *PK* 决定的，但很难根据 *PK* 计算出 *SK*。</u> 

> **任何加密方法的安全性取决于密钥的长度，以及攻破密文所需的计算量。**



##### 公钥算法的特点

密钥对产生器产生出接收者 B 的**一对密钥**：**加密密钥 $PK_B$** 和**解密密钥 $SK_B$** 。

+ 加密密钥 $PK_B$ 就是接收者B的公钥，它向公众公开。
+ 解密密钥 $SK_B$ 就是接收者B的私钥，对其他人都保密。


​      发送者 A 用 B 的公钥 PKB 对明文 X 加密（E 运算）后，接收者 B 用自己的私钥 SKB 解密（D 运算），即可恢复出明文：

$$
D_{SK_B}\left(E_{PK_B}\left(X\right)\right) = X
$$

> 加密算法 E 和解密算法 D 具体的实现是公开的。



1. 加密密钥是公开的，但不能用它来解密，即：

$$
D_{PK_B}\left(E_{PK_B}\left(X\right)\right) \neq X
$$

2. 加密和解密**运算**可以对调，即**加密和解密**是互逆的：

$$
E_{PK_B}\left(D_{SK_B}\left(X\right)\right) = X = D_{SK_B}\left(E_{PK_B}\left(X\right)\right)
$$

<img src="https://i0.hdslb.com/bfs/album/cc8822e10fee96c404d6389e04b73d005d4f7c2e.png" alt="image-20211224112250240" style="zoom:50%;" />



#### 对称密钥与公开密钥的对比

对称密钥：**一对一的双向保密通信**

公开密钥：**多对一的单向保密通信**

#### 公钥密码体制

+ 如果某一信息用**公开密钥加密**，则必须用**私有密钥解密**，这就是实现**保密**的方法
+ 如果某一信息用**私有密钥加密**，那么，它必须用**公开密钥解密**。这就是实现**数字签名**的方法



### 数字签名

数字签名必须保证以下三点：

1. **报文鉴别**——接收者能够核实发送者对报文的签名（证明来源）

2. **报文的完整性**——发送者事后不能抵赖对报文的签名（防否认）

3. **不可否认**——接收者不能伪造对报文的签名（防伪造）

现在已有多种实现各种数字签名的方法。但采用**公钥算法**更容易实现。 



私钥加密，公钥解密（核实签名）

<img src="https://i0.hdslb.com/bfs/album/bbb0ea84bff036d38489118ee8e4773542d72a3b.png" alt="image-20211224163608202" style="zoom:50%;" />





#### **保密性的数字签名**

![image-20211224163717795](https://i0.hdslb.com/bfs/album/5ddf64365407d0cfe2220f62c454200f9e746354.png)



### 报文鉴别

> 而对付**主动攻击**中的<u>篡改</u>和<u>伪造</u>则要用鉴别

​	报文鉴别使得通信的接收方能够验证所收到的报文（发送者和报文内容、发送时间、序列等）的真伪。



#### 鉴别分类

+ 报文鉴别
  + 即<u>鉴别所收到的报文的确是报文的发送者所发送的</u>，而不是其他人伪造的或篡改的。这就包含了**端点鉴别**和**报文完整性的鉴别**。

    > **数字签名**就能够实现对报文的鉴别。
+ 实体鉴别
  + 仅仅鉴别发送报文的实体。实体可以是一个人，也可以是一个进程（客户或服务器）。这就是**端点鉴别**。

#### 报文鉴别

1. **数字签名**就能够实现对报文的鉴别。
   1. 缺点：较长报文增加运算量

2. **密码散列函数 (cryptographic hash function)**是一种相对简单的对报文进行鉴别的方法（MD5、SHA-1）
   1. 特点：单向性

1.散列函数的输入长度可以很长，但其**输出长度则是固定的**，并且较短。散列函数的输出叫做散列值，或称为散列。

2.不同的散列值肯定对应于不同的输入，但不同的输入却可能得出相同的散列值。这就是说，**散列函数的输入和输出并非一一对应，而是多对一的**。

#### 实体鉴别

​	实体鉴别是在系统接入的全部持续时间内**对和自己通信的对方实体只需验证一次**。



时间：2021年12月24日 16:57
作者：于邦霆 [^2]
笔名：鱼街
微信：ybt13412370977
QQ: 1213728568
邮箱：yubangting@outlook.com

[^1]: 《计算机网络》（第8版） / 谢希仁编著 ISBN: 978-7-121-41174
[^2]:华南农业大学 数学与信息学院、软件学院 2019级计算机科学与技术专业

